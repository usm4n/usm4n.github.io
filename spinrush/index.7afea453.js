function t(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var e=Object.defineProperty,r=(t,r)=>e(t,"name",{value:r,configurable:!0}),i=(t,r,i)=>(((t,r,i)=>{r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i})(t,"symbol"!=typeof r?r+"":r,i),i),n=(()=>{for(var t=new Uint8Array(128),e=0;e<64;e++)t[e<26?e+65:e<52?e+71:e<62?e-4:4*e-205]=e;return e=>{for(var r=e.length,i=new Uint8Array(3*(r-("="==e[r-1])-("="==e[r-2]))/4|0),n=0,o=0;n<r;){var s=t[e.charCodeAt(n++)],a=t[e.charCodeAt(n++)],l=t[e.charCodeAt(n++)],u=t[e.charCodeAt(n++)];i[o++]=s<<2|a>>4,i[o++]=a<<4|l>>2,i[o++]=l<<6|u}return i}})();function o(t){return t*Math.PI/180}function s(t){return 180*t/Math.PI}function a(t,e,r){return e>r?a(t,r,e):Math.min(Math.max(t,e),r)}function l(t,e,r){return t+(e-t)*r}function u(t,e,r,i,n){return i+(t-e)/(r-e)*(n-i)}function h(t,e,r,i,n){return a(u(t,e,r,i,n),i,n)}r(o,"deg2rad"),r(s,"rad2deg"),r(a,"clamp"),r(l,"lerp"),r(u,"map"),r(h,"mapc");var d=class{static fromAngle(t){let e=o(t);return new d(Math.cos(e),Math.sin(e))}clone(){return new d(this.x,this.y)}add(...t){let e=A(...t);return new d(this.x+e.x,this.y+e.y)}sub(...t){let e=A(...t);return new d(this.x-e.x,this.y-e.y)}scale(...t){let e=A(...t);return new d(this.x*e.x,this.y*e.y)}dist(...t){let e=A(...t);return Math.sqrt((this.x-e.x)*(this.x-e.x)+(this.y-e.y)*(this.y-e.y))}len(){return this.dist(new d(0,0))}unit(){let t=this.len();return 0===t?new d(0):this.scale(1/t)}normal(){return new d(this.y,-this.x)}dot(t){return this.x*t.x+this.y*t.y}angle(...t){let e=A(...t);return s(Math.atan2(this.y-e.y,this.x-e.x))}lerp(t,e){return new d(l(this.x,t.x,e),l(this.y,t.y,e))}isZero(){return 0===this.x&&0===this.y}toFixed(t){return new d(Number(this.x.toFixed(t)),Number(this.y.toFixed(t)))}eq(t){return this.x===t.x&&this.y===t.y}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}constructor(e=0,r=e){t(this,"x",0),t(this,"y",0),this.x=e,this.y=r}},c=d;function A(...t){if(1===t.length){if(t[0]instanceof c)return A(t[0].x,t[0].y);if(Array.isArray(t[0])&&2===t[0].length)return A(...t[0])}return new c(...t)}r(c,"Vec2"),i(c,"LEFT",new d(-1,0)),i(c,"RIGHT",new d(1,0)),i(c,"UP",new d(0,-1)),i(c,"DOWN",new d(0,1)),r(A,"vec2");var f=class{xy(){return A(this.x,this.y)}constructor(e,r,i){t(this,"x",0),t(this,"y",0),t(this,"z",0),this.x=e,this.y=r,this.z=i}};r(f,"Vec3");var p=r(((t,e,r)=>new f(t,e,r)),"vec3"),g=class{static fromArray(t){return new g(t[0],t[1],t[2])}clone(){return new g(this.r,this.g,this.b)}lighten(t){return new g(this.r+t,this.g+t,this.b+t)}darken(t){return this.lighten(-t)}invert(){return new g(255-this.r,255-this.g,255-this.b)}mult(t){return new g(this.r*t.r/255,this.g*t.g/255,this.b*t.b/255)}eq(t){return this.r===t.r&&this.g===t.g&&this.b===t.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}static fromHSL(t,e,i){if(0==e)return V(255*i,255*i,255*i);let n=r(((t,e,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t)),"hue2rgb"),o=i<.5?i*(1+e):i+e-i*e,s=2*i-o,a=n(s,o,t+1/3),l=n(s,o,t),u=n(s,o,t-1/3);return new g(Math.round(255*a),Math.round(255*l),Math.round(255*u))}constructor(e,r,i){t(this,"r",255),t(this,"g",255),t(this,"b",255),this.r=a(e,0,255),this.g=a(r,0,255),this.b=a(i,0,255)}},m=g;function V(...t){if(0===t.length)return new m(255,255,255);if(1===t.length){if(t[0]instanceof m)return t[0].clone();if(Array.isArray(t[0])&&3===t[0].length)return m.fromArray(t[0])}return new m(...t)}r(m,"Color"),i(m,"RED",V(255,0,0)),i(m,"GREEN",V(0,255,0)),i(m,"BLUE",V(0,0,255)),i(m,"YELLOW",V(255,255,0)),i(m,"MAGENTA",V(255,0,255)),i(m,"CYAN",V(0,255,255)),i(m,"WHITE",V(255,255,255)),i(m,"BLACK",V(0,0,0)),r(V,"rgb");var w=r(((t,e,r)=>m.fromHSL(t,e,r)),"hsl2rgb"),v=class{scale(t){return new v(this.x+this.w*t.x,this.y+this.h*t.y,this.w*t.w,this.h*t.h)}clone(){return new v(this.x,this.y,this.w,this.h)}eq(t){return this.x===t.x&&this.y===t.y&&this.w===t.w&&this.h===t.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}constructor(e,r,i,n){t(this,"x",0),t(this,"y",0),t(this,"w",1),t(this,"h",1),this.x=e,this.y=r,this.w=i,this.h=n}};function y(t,e,r,i){return new v(t,e,r,i)}r(v,"Quad"),r(y,"quad");var E=class{static translate(t){return new E([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,0,1])}static scale(t){return new E([t.x,0,0,0,0,t.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(t){return t=o(-t),new E([1,0,0,0,0,Math.cos(t),-Math.sin(t),0,0,Math.sin(t),Math.cos(t),0,0,0,0,1])}static rotateY(t){return t=o(-t),new E([Math.cos(t),0,Math.sin(t),0,0,1,0,0,-Math.sin(t),0,Math.cos(t),0,0,0,0,1])}static rotateZ(t){return t=o(-t),new E([Math.cos(t),-Math.sin(t),0,0,Math.sin(t),Math.cos(t),0,0,0,0,1,0,0,0,0,1])}translate(t){return this.mult(E.translate(t))}scale(t){return this.mult(E.scale(t))}rotateX(t){return this.mult(E.rotateX(t))}rotateY(t){return this.mult(E.rotateY(t))}rotateZ(t){return this.mult(E.rotateZ(t))}mult(t){let e=[];for(let r=0;r<4;r++)for(let i=0;i<4;i++)e[4*r+i]=this.m[0+i]*t.m[4*r+0]+this.m[4+i]*t.m[4*r+1]+this.m[8+i]*t.m[4*r+2]+this.m[12+i]*t.m[4*r+3];return new E(e)}multVec4(t){return{x:t.x*this.m[0]+t.y*this.m[4]+t.z*this.m[8]+t.w*this.m[12],y:t.x*this.m[1]+t.y*this.m[5]+t.z*this.m[9]+t.w*this.m[13],z:t.x*this.m[2]+t.y*this.m[6]+t.z*this.m[10]+t.w*this.m[14],w:t.x*this.m[3]+t.y*this.m[7]+t.z*this.m[11]+t.w*this.m[15]}}multVec3(t){let e=this.multVec4({x:t.x,y:t.y,z:t.z,w:1});return p(e.x,e.y,e.z)}multVec2(t){return A(t.x*this.m[0]+t.y*this.m[4]+0*this.m[8]+1*this.m[12],t.x*this.m[1]+t.y*this.m[5]+0*this.m[9]+1*this.m[13])}invert(){let t=[],e=this.m[10]*this.m[15]-this.m[14]*this.m[11],r=this.m[9]*this.m[15]-this.m[13]*this.m[11],i=this.m[9]*this.m[14]-this.m[13]*this.m[10],n=this.m[8]*this.m[15]-this.m[12]*this.m[11],o=this.m[8]*this.m[14]-this.m[12]*this.m[10],s=this.m[8]*this.m[13]-this.m[12]*this.m[9],a=this.m[6]*this.m[15]-this.m[14]*this.m[7],l=this.m[5]*this.m[15]-this.m[13]*this.m[7],u=this.m[5]*this.m[14]-this.m[13]*this.m[6],h=this.m[4]*this.m[15]-this.m[12]*this.m[7],d=this.m[4]*this.m[14]-this.m[12]*this.m[6],c=this.m[5]*this.m[15]-this.m[13]*this.m[7],A=this.m[4]*this.m[13]-this.m[12]*this.m[5],f=this.m[6]*this.m[11]-this.m[10]*this.m[7],p=this.m[5]*this.m[11]-this.m[9]*this.m[7],g=this.m[5]*this.m[10]-this.m[9]*this.m[6],m=this.m[4]*this.m[11]-this.m[8]*this.m[7],V=this.m[4]*this.m[10]-this.m[8]*this.m[6],w=this.m[4]*this.m[9]-this.m[8]*this.m[5];t[0]=this.m[5]*e-this.m[6]*r+this.m[7]*i,t[4]=-(this.m[4]*e-this.m[6]*n+this.m[7]*o),t[8]=this.m[4]*r-this.m[5]*n+this.m[7]*s,t[12]=-(this.m[4]*i-this.m[5]*o+this.m[6]*s),t[1]=-(this.m[1]*e-this.m[2]*r+this.m[3]*i),t[5]=this.m[0]*e-this.m[2]*n+this.m[3]*o,t[9]=-(this.m[0]*r-this.m[1]*n+this.m[3]*s),t[13]=this.m[0]*i-this.m[1]*o+this.m[2]*s,t[2]=this.m[1]*a-this.m[2]*l+this.m[3]*u,t[6]=-(this.m[0]*a-this.m[2]*h+this.m[3]*d),t[10]=this.m[0]*c-this.m[1]*h+this.m[3]*A,t[14]=-(this.m[0]*u-this.m[1]*d+this.m[2]*A),t[3]=-(this.m[1]*f-this.m[2]*p+this.m[3]*g),t[7]=this.m[0]*f-this.m[2]*m+this.m[3]*V,t[11]=-(this.m[0]*p-this.m[1]*m+this.m[3]*w),t[15]=this.m[0]*g-this.m[1]*V+this.m[2]*w;let v=this.m[0]*t[0]+this.m[1]*t[4]+this.m[2]*t[8]+this.m[3]*t[12];for(let e=0;e<4;e++)for(let r=0;r<4;r++)t[4*e+r]*=1/v;return new E(t)}clone(){return new E(this.m)}toString(){return this.m.toString()}constructor(e){t(this,"m",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),e&&(this.m=e)}};function x(t,e,r,i=Math.sin){return t+(i(r)+1)/2*(e-t)}r(E,"Mat4"),r(x,"wave");var S=class{gen(){return this.seed=(1103515245*this.seed+12345)%2147483648,this.seed/2147483648}genNumber(t,e){return t+this.gen()*(e-t)}genVec2(t,e){return new c(this.genNumber(t.x,e.x),this.genNumber(t.y,e.y))}genColor(t,e){return new m(this.genNumber(t.r,e.r),this.genNumber(t.g,e.g),this.genNumber(t.b,e.b))}genAny(...t){if(0===t.length)return this.gen();if(1===t.length){if("number"==typeof t[0])return this.genNumber(0,t[0]);if(t[0]instanceof c)return this.genVec2(A(0,0),t[0]);if(t[0]instanceof m)return this.genColor(V(0,0,0),t[0])}else if(2===t.length){if("number"==typeof t[0]&&"number"==typeof t[1])return this.genNumber(t[0],t[1]);if(t[0]instanceof c&&t[1]instanceof c)return this.genVec2(t[0],t[1]);if(t[0]instanceof m&&t[1]instanceof m)return this.genColor(t[0],t[1])}}constructor(e){t(this,"seed",void 0),this.seed=e}};r(S,"RNG");var b=new S(Date.now());function R(t){return null!=t&&(b.seed=t),b.seed}function T(...t){return b.genAny(...t)}function B(...t){return Math.floor(T(...t))}function U(t){return T()<=t}function I(t){return t[B(t.length)]}function F(t,e){return t.pos.x+t.width>=e.pos.x&&t.pos.x<=e.pos.x+e.width&&t.pos.y+t.height>=e.pos.y&&t.pos.y<=e.pos.y+e.height}function M(t,e){return t.pos.x+t.width>e.pos.x&&t.pos.x<e.pos.x+e.width&&t.pos.y+t.height>e.pos.y&&t.pos.y<e.pos.y+e.height}function C(t,e){if(t.p1.x===t.p2.x&&t.p1.y===t.p2.y||e.p1.x===e.p2.x&&e.p1.y===e.p2.y)return null;let r=(e.p2.y-e.p1.y)*(t.p2.x-t.p1.x)-(e.p2.x-e.p1.x)*(t.p2.y-t.p1.y);if(0===r)return null;let i=((e.p2.x-e.p1.x)*(t.p1.y-e.p1.y)-(e.p2.y-e.p1.y)*(t.p1.x-e.p1.x))/r,n=((t.p2.x-t.p1.x)*(t.p1.y-e.p1.y)-(t.p2.y-t.p1.y)*(t.p1.x-e.p1.x))/r;return i<0||i>1||n<0||n>1?null:i}function P(t,e){let r=C(t,e);return r?A(t.p1.x+r*(t.p2.x-t.p1.x),t.p1.y+r*(t.p2.y-t.p1.y)):null}function k(t,e){if(D(t,O.fromVec2(e.p1))||D(t,O.fromVec2(e.p2)))return!0;let r=t.points();return!!(P(e,new G(r[0],r[1]))||P(e,new G(r[1],r[2]))||P(e,new G(r[2],r[3]))||P(e,new G(r[3],r[0])))}function D(t,e){return e.x>t.pos.x&&e.x<t.pos.x+t.width&&e.y>t.pos.y&&e.y<t.pos.y+t.height}function L(t,e){return t.center.dist(e.toVec2())<t.radius}function N(t,e){let r=!1,i=t.pts;for(let t=0,n=i.length-1;t<i.length;n=t++)i[t].y>e.y!=i[n].y>e.y&&e.x<(i[n].x-i[t].x)*(e.y-i[t].y)/(i[n].y-i[t].y)+i[t].x&&(r=!r);return r}r(R,"randSeed"),r(T,"rand"),r(B,"randi"),r(U,"chance"),r(I,"choose"),r(F,"testRectRect2"),r(M,"testRectRect"),r(C,"testLineLineT"),r(P,"testLineLine"),r(k,"testRectLine"),r(D,"testRectPoint"),r(L,"testCirclePoint"),r(N,"testPolygonPoint");var G=class{transform(t){return new G(t.multVec2(this.p1),t.multVec2(this.p2))}bbox(){return Q.fromPoints(this.p1,this.p2)}constructor(e,r){t(this,"p1",void 0),t(this,"p2",void 0),this.p1=e,this.p2=r}};r(G,"Line");var Q=class{static fromPoints(t,e){return new Q(t.clone(),e.x-t.x,e.y-t.y)}center(){return new c(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(t){return new q(this.points().map((e=>t.multVec2(e))))}bbox(){return new Q(this.pos.clone(),this.width,this.height)}constructor(e,r,i){t(this,"pos",void 0),t(this,"width",void 0),t(this,"height",void 0),this.pos=e,this.width=r,this.height=i}};r(Q,"Rect");var Y=class{transform(t){return new K(this.center,this.radius,this.radius).transform(t)}bbox(){return Q.fromPoints(this.center.sub(A(this.radius)),this.center.add(A(this.radius)))}constructor(e,r){t(this,"center",void 0),t(this,"radius",void 0),this.center=e,this.radius=r}};r(Y,"Circle");var K=class{transform(t){return new K(t.multVec2(this.center),t.m[0]*this.radiusX,t.m[5]*this.radiusY)}bbox(){return Q.fromPoints(this.center.sub(A(this.radiusX,this.radiusY)),this.center.add(A(this.radiusX,this.radiusY)))}constructor(e,r,i){t(this,"center",void 0),t(this,"radiusX",void 0),t(this,"radiusY",void 0),this.center=e,this.radiusX=r,this.radiusY=i}};r(K,"Ellipse");var q=class{transform(t){return new q(this.pts.map((e=>t.multVec2(e))))}bbox(){let t=A(Number.MAX_VALUE),e=A(-Number.MAX_VALUE);for(let r of this.pts)t.x=Math.min(t.x,r.x),e.x=Math.max(e.x,r.x),t.y=Math.min(t.y,r.y),e.y=Math.max(e.y,r.y);return Q.fromPoints(t,e)}constructor(e){if(t(this,"pts",void 0),e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}};r(q,"Polygon");var O=class{static fromVec2(t){return new O(t.x,t.y)}toVec2(){return new c(this.x,this.y)}transform(t){return O.fromVec2(t.multVec2(this.toVec2()))}bbox(){return new Q(this.toVec2(),0,0)}constructor(e,r){t(this,"x",void 0),t(this,"y",void 0),this.x=e,this.y=r}};function H(t,e){let r=Number.MAX_VALUE,i=A(0);for(let n of[t,e])for(let o=0;o<n.pts.length;o++){let s=n.pts[o],a=n.pts[(o+1)%n.pts.length].sub(s).normal().unit(),l=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(let e=0;e<t.pts.length;e++){let r=t.pts[e].dot(a);l=Math.min(l,r),u=Math.max(u,r)}let h=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let t=0;t<e.pts.length;t++){let r=e.pts[t].dot(a);h=Math.min(h,r),d=Math.max(d,r)}let c=Math.min(u,d)-Math.max(l,h);if(c<0)return null;if(c<Math.abs(r)){let t=d-l,e=h-u;r=Math.abs(t)<Math.abs(e)?t:e,i=a.scale(r)}}return i}r(O,"Point"),r(H,"sat");var J=class extends Map{push(t){let e=this.lastID;return this.set(e,t),this.lastID++,e}pushd(t){let e=this.push(t);return()=>this.delete(e)}constructor(...e){super(...e),t(this,"lastID",void 0),this.lastID=0}};r(J,"IDList");var z=class{add(t){return this.handlers.pushd(t)}addOnce(t){let e=this.add(((...r)=>{t(...r),e()}));return e}trigger(...t){this.handlers.forEach((e=>e(...t)))}numListeners(){return this.handlers.size}constructor(){t(this,"handlers",new J)}};r(z,"Event");var j=class{on(t,e){return this.handlers.get(t)||this.handlers.set(t,new z),this.handlers.get(t).add(e)}onOnce(t,e){let r=this.on(t,((...t)=>{e(...t),r()}));return r}trigger(t,...e){this.handlers.get(t)&&this.handlers.get(t).trigger(...e)}remove(t){this.handlers.delete(t)}clear(){this.handlers=new Map}numListeners(t){var e,r;return null!==(r=null===(e=this.handlers.get(t))||void 0===e?void 0:e.numListeners())&&void 0!==r?r:0}constructor(){t(this,"handlers",new Map)}};function W(t,e){let r=typeof t,i=typeof e;if(r!==i)return!1;if("object"===r&&"object"===i){let r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(let i of r){let r=t[i],n=e[i];if(("function"!=typeof r||"function"!=typeof n)&&!W(r,n))return!1}return!0}return t===e}function X(t){let e=window.atob(t),r=e.length,i=new Uint8Array(r);for(let t=0;t<r;t++)i[t]=e.charCodeAt(t);return i.buffer}function Z(t){return X(t.split(",")[1])}function _(t,e){let r=document.createElement("a");r.href=e,r.download=t,r.click()}function $(t,e){_(t,"data:text/plain;charset=utf-8,"+e)}function tt(t,e){$(t,JSON.stringify(e))}function et(t,e){let r=URL.createObjectURL(e);_(t,r),URL.revokeObjectURL(r)}function rt(t){return t.match(/^data:\w+\/\w+;base64,.+/)}r(j,"EventHandler"),r(W,"deepEq"),r(X,"base64ToArrayBuffer"),r(Z,"dataURLToArrayBuffer"),r(_,"download"),r($,"downloadText"),r(tt,"downloadJSON"),r(et,"downloadBlob"),r(rt,"isDataURL");var it=(()=>{let t=0;return()=>t++})(),nt=class{tick(t){this.dts.push(t),this.timer+=t,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce(((t,e)=>t+e))/this.dts.length)),this.dts=[])}constructor(){t(this,"dts",[]),t(this,"timer",0),t(this,"fps",0)}};r(nt,"FPSCounter");var ot=class{tick(t){return!this.finished&&!this.paused&&(this.time-=t,this.time<=0&&(this.action(),this.finished=!0,this.time=0,!0))}reset(t){this.time=t,this.finished=!1}constructor(e,r){t(this,"time",void 0),t(this,"action",void 0),t(this,"finished",!1),t(this,"paused",!1),this.time=e,this.action=r}};r(ot,"Timer");((t,r)=>{for(var i in r)e(t,i,{get:r[i],enumerable:!0})})({},{default:()=>st});var st=n("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),at={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"},lt=["left","middle","right","back","forward"],ut=["space","left","right","up","down","tab","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","s"],ht=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",ct=[{name:"a_pos",size:3},{name:"a_uv",size:2},{name:"a_color",size:4}],At=ct.reduce(((t,e)=>t+e.size),0),ft=8192*At,pt="\nattribute vec3 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec3 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n",gt="\nprecision mediump float;\n\nvarying vec3 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n",mt="\nvec4 vert(vec3 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n",Vt="\nvec4 frag(vec3 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n",wt=new Set(["id","require"]),vt=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function yt(t){return"pressed"===t||"rpressed"===t?"down":"released"===t?"up":t}function Et(t){t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}function xt(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function St(){return document.fullscreenElement||document.webkitFullscreenElement}function bt(t){switch(t){case"topleft":return A(-1,-1);case"top":return A(0,-1);case"topright":return A(1,-1);case"left":return A(-1,0);case"center":return A(0,0);case"right":return A(1,0);case"botleft":return A(-1,1);case"bot":return A(0,1);case"botright":return A(1,1);default:return t}}function Rt(t){switch(t){case"left":default:return 0;case"center":return.5;case"right":return 1}}function Tt(){return new AudioBuffer({length:1,numberOfChannels:1,sampleRate:44100})}function Bt(t,e){return center().add(Vec2.fromAngle(t).scale(e))}r(yt,"processButtonState"),r(Et,"enterFullscreen"),r(xt,"exitFullscreen"),r(St,"getFullscreenElement"),r(bt,"anchorPt"),r(Rt,"alignPt"),r(Tt,"createEmptyAudioBuffer"),r(((e={})=>{let i=[],n=(()=>{var t;let r=null!==(t=e.root)&&void 0!==t?t:document.body;var i,n;r===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let o=null!==(i=e.canvas)&&void 0!==i?i:(()=>{let t=document.createElement("canvas");return r.appendChild(t),t})(),s=null!==(n=e.scale)&&void 0!==n?n:1,a=!(e.width&&e.height&&!e.stretch&&!e.letterbox),l=o.parentElement.offsetWidth,u=o.parentElement.offsetHeight;a?(o.width=l,o.height=u):(o.width=e.width*s,o.height=e.height*s);let h=o.width,d=o.height,c=e.pixelDensity||window.devicePixelRatio;o.width*=c,o.height*=c;let f=[`width: ${h}px`,`height: ${d}px`,"outline: none","cursor: default"];return e.crisp&&(f.push("image-rendering: pixelated"),f.push("image-rendering: crisp-edges")),o.style.cssText=f.join(";"),o.tabIndex=0,{canvas:o,canvas2:o.cloneNode(),pixelDensity:c,stretchToParent:a,lastParentWidth:l,lastParentHeight:u,keyStates:{},mouseStates:{},virtualButtonStates:{},charInputted:[],numKeyDown:0,isMouseMoved:!1,isKeyPressed:!1,isKeyPressedRepeat:!1,isKeyReleased:!1,mouseStarted:!1,mousePos:A(0,0),mouseDeltaPos:A(0,0),time:0,realTime:0,skipTime:!1,dt:0,numFrames:0,isTouch:"ontouchstart"in window||navigator.maxTouchPoints>0,loopID:null,stopped:!1,paused:!1,fpsCounter:new nt}})(),d=n.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});class g{static fromImage(t,e={}){let r=new g(0,0,e);return r.bind(),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,t),r.width=t.width,r.height=t.height,r.unbind(),r}update(t,e,r){this.bind(),d.texSubImage2D(d.TEXTURE_2D,0,t,e,d.RGBA,d.UNSIGNED_BYTE,r),this.unbind()}bind(){d.bindTexture(d.TEXTURE_2D,this.glTex)}unbind(){d.bindTexture(d.TEXTURE_2D,null)}free(){d.deleteTexture(this.glTex)}constructor(r,n,o={}){t(this,"glTex",void 0),t(this,"width",void 0),t(this,"height",void 0),this.glTex=d.createTexture(),i.push((()=>this.free())),this.bind(),r&&n&&d.texImage2D(d.TEXTURE_2D,0,d.RGBA,r,n,0,d.RGBA,d.UNSIGNED_BYTE,null),this.width=r,this.height=n;let s="linear"===(null!==(l=o.filter)&&void 0!==l?l:e.texFilter)?d.LINEAR:d.NEAREST,a="repeat"===o.wrap?d.REPEAT:d.CLAMP_TO_EDGE;var l;d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,a),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,a),this.unbind()}}r(g,"Texture");let b=(()=>{let t=le(mt,Vt),r=g.fromImage(new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1));if(e.background){let t=m.fromArray(e.background);var i;d.clearColor(t.r/255,t.g/255,t.b/255,null!==(i=e.background[3])&&void 0!==i?i:1)}d.enable(d.BLEND),d.enable(d.SCISSOR_TEST),d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);let n=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,n),d.bufferData(d.ARRAY_BUFFER,4*ft,d.DYNAMIC_DRAW),ct.reduce(((t,e,r)=>(d.vertexAttribPointer(r,e.size,d.FLOAT,!1,4*At,t),d.enableVertexAttribArray(r),t+4*e.size)),0),d.bindBuffer(d.ARRAY_BUFFER,null);let o=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),d.bufferData(d.ELEMENT_ARRAY_BUFFER,49152,d.DYNAMIC_DRAW),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null);let s=g.fromImage(new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{drawCalls:0,lastDrawCalls:0,defShader:t,curShader:t,defTex:r,curTex:r,curUniform:{},vbuf:n,ibuf:o,vqueue:[],iqueue:[],transform:new E,transformStack:[],bgTex:s,width:e.width,height:e.height,viewport:{x:0,y:0,width:d.drawingBufferWidth,height:d.drawingBufferHeight}}})();class C{static from(t,e={}){return"string"==typeof t?C.fromURL(t,e):Promise.resolve(C.fromImage(t,e))}static fromImage(t,e={}){var r;return new C(g.fromImage(t,e),Yt(e.sliceX||1,e.sliceY||1),null!==(r=e.anims)&&void 0!==r?r:{})}static fromURL(t,e={}){return Nt(t).then((t=>C.fromImage(t,e)))}constructor(e,r,i={}){t(this,"tex",void 0),t(this,"frames",[new v(0,0,1,1)]),t(this,"anims",{}),this.tex=e,r&&(this.frames=r),this.anims=i}}r(C,"SpriteData");class K{static fromArrayBuffer(t){return new Promise(((e,r)=>X.ctx.decodeAudioData(t,e,r))).then((t=>new K(t)))}static fromURL(t){return rt(t)?K.fromArrayBuffer(Z(t)):Lt(t).then((t=>K.fromArrayBuffer(t)))}constructor(e){t(this,"buf",void 0),this.buf=e}}r(K,"SoundData");let X=(()=>{let t=new(window.AudioContext||window.webkitAudioContext),e=t.createGain();e.connect(t.destination);let r=new K(Tt());return t.decodeAudioData(st.buffer.slice(0),(t=>{r.buf=t}),(()=>{throw new Error("Failed to load burp.")})),{ctx:t,masterNode:e,burpSnd:r}})();class dt{static loaded(t){let e=new dt(Promise.resolve(t));return e.data=t,e.done=!0,e}onLoad(t){return this.onLoadEvents.add(t),this}onError(t){return this.onErrorEvents.add(t),this}onFinish(t){return this.onFinishEvents.add(t),this}then(t){return this.onLoad(t)}catch(t){return this.onError(t)}finally(t){return this.onFinish(t)}constructor(e){t(this,"done",!1),t(this,"data",null),t(this,"error",null),t(this,"onLoadEvents",new z),t(this,"onErrorEvents",new z),t(this,"onFinishEvents",new z),e.then((t=>{this.data=t,this.onLoadEvents.trigger(t)})).catch((t=>{if(this.error=t,!(this.onErrorEvents.numListeners()>0))throw t;this.onErrorEvents.trigger(t)})).finally((()=>{this.onFinishEvents.trigger(),this.done=!0}))}}r(dt,"Asset");class Bt{add(t,e){let r=null!=t?t:this.lastUID+++"",i=new dt(e);return this.assets.set(r,i),i}addLoaded(t,e){let r=null!=t?t:this.lastUID+++"",i=dt.loaded(e);this.assets.set(r,i)}get(t){return this.assets.get(t)}progress(){if(0===this.assets.size)return 1;let t=0;return this.assets.forEach((e=>{e.done&&t++})),t/this.assets.size}constructor(){t(this,"assets",new Map),t(this,"lastUID",0)}}r(Bt,"AssetBucket");let Ut={urlPrefix:"",sprites:new Bt,fonts:new Bt,bitmapFonts:new Bt,sounds:new Bt,shaders:new Bt,custom:new Bt,loaded:!1},It={ev:new j,objEvents:new j,root:Ir([]),timers:new J,gravity:0,scenes:{},logs:[],cam:{pos:null,scale:A(1),angle:0,shake:0,transform:new E}};function Ft(t){return Ut.custom.add(null,t)}function Mt(){let t=[Ut.sprites,Ut.sounds,Ut.shaders,Ut.fonts,Ut.bitmapFonts,Ut.custom];return t.reduce(((t,e)=>t+e.progress()),0)/t.length}function Ct(t){return void 0!==t&&(Ut.urlPrefix=t),Ut.urlPrefix}function Pt(t){let e=Ut.urlPrefix+t;return fetch(e).then((t=>{if(!t.ok)throw new Error(`Failed to fetch ${e}`);return t}))}function kt(t){return Pt(t).then((t=>t.json()))}function Dt(t){return Pt(t).then((t=>t.text()))}function Lt(t){return Pt(t).then((t=>t.arrayBuffer()))}function Nt(t){let e=new Image;return e.src=rt(t)?t:Ut.urlPrefix+t,e.crossOrigin="anonymous",new Promise(((r,i)=>{e.onload=()=>r(e),e.onerror=()=>i(new Error(`Failed to load image from "${t}"`))}))}function Gt(t,e){let r=new FontFace(t,"string"==typeof e?`url(${e})`:e);return document.fonts.add(r),Ut.fonts.add(t,r.load().catch((()=>{throw new Error(`Failed to load font from "${e}"`)})))}function Qt(t,e,r,i,n={}){var o;return Ut.bitmapFonts.add(t,Nt(e).then((t=>ue(g.fromImage(t,n),r,i,null!==(o=n.chars)&&void 0!==o?o:ht))))}function Yt(t=1,e=1,r=0,i=0,n=1,o=1){let s=[],a=n/t,l=o/e;for(let n=0;n<e;n++)for(let e=0;e<t;e++)s.push(new v(r+e*a,i+n*l,a,l));return s}function Kt(t,e){return Ft("string"==typeof e?new Promise(((r,i)=>{kt(e).then((e=>{Kt(t,e).onLoad(r).onError(i)}))})):C.from(t).then((t=>{let r={};for(let i in e){let n=t.tex.width,o=t.tex.height,s=e[i],a=new C(t.tex,Yt(s.sliceX,s.sliceY,s.x/n,s.y/o,s.width/n,s.height/o),s.anims);Ut.sprites.addLoaded(i,a),r[i]=a}return r})))}function qt(t,e,r={sliceX:1,sliceY:1,anims:{}}){return Ut.sprites.add(t,"string"==typeof e?C.fromURL(e,r):Promise.resolve(C.fromImage(e,r)))}function Ot(t,e){return Ut.sprites.add(t,new Promise((async t=>{let r="string"==typeof e?await kt(e):e,i=await Promise.all(r.frames.map(Nt)),n=document.createElement("canvas");n.width=r.width,n.height=r.height*r.frames.length;let o=n.getContext("2d");i.forEach(((t,e)=>{o.drawImage(t,0,e*r.height)})),t(await qt(null,n,{sliceY:r.frames.length,anims:r.anims}))})))}function Ht(t,e,r){return Ut.sprites.add(t,new Promise((async t=>{let i=await qt(null,e),n="string"==typeof r?await kt(r):r,o=n.meta.size;i.frames=n.frames.map((t=>new v(t.frame.x/o.w,t.frame.y/o.h,t.frame.w/o.w,t.frame.h/o.h)));for(let t of n.meta.frameTags)t.from===t.to?i.anims[t.name]=t.from:i.anims[t.name]={from:t.from,to:t.to,speed:10,loop:!0,pingpong:"pingpong"===t.direction};t(i)})))}function Jt(t,e,i,n=!1){return Ut.shaders.add(t,new Promise(((t,o)=>{let s=r((t=>t?Dt(t):new Promise((t=>t(null)))),"resolveUrl");if(n)Promise.all([s(e),s(i)]).then((([e,r])=>{t(le(e,r))})).catch(o);else try{t(le(e,i))}catch(t){o(t)}})))}function zt(t,e){return Ut.sounds.add(t,"string"==typeof e?K.fromURL(e):K.fromArrayBuffer(e))}function jt(t="bean"){return qt(t,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAA2CAMAAABAzG8wAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEyUExURQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcPCw4ICA4dFw4eFg4eFxAQEBUsIhUtIhwPDxwQEBw8LR07LR08LSAgICNKOCNLOCRKOCRLOCoXFypZQypaQytZQytaQzAwMDFoTjFoTzFpTzgfHzh3WTh3Wjh4Wjl3WTl3Wjl4Wj+GZUBAQECGZECGZUCHZUYnJ0aVcEeVcE2ke06ke06kfFBQUFQuLlSzhlUuLlWzhlvCkVzCkVzCkmBgYGM2NmPRnWrgqHA+PnBwcHHvs35FRYCAgIxNTY1NTZCQkJtUVJtVVZ+fn6CgoKlcXKldXbdkZL+/v8Vra8VsbNDQ0NNzc9/f3+F7e////ysmAfQAAAAVdFJOUwAQIDBAUGBvcH+AkJ+gr7C/z9Df74JQjt0AAAO5SURBVEjHnVfrQtowFKaADC1qu9I6YSBecIKoOHAD2bhssMpc6zqn010c0/H+r7CcJG2TFAru/LCYnu/kO9ekkUiIxBJyStXSOhJNVeRkPPIIiS8qGMlJWklE50PLQbArKzN5SIuaHiraQjjc3/zZ7lHHtGwHiTXs1XYz7ovUdEc8uLHfsRxRhq1MOIn4U4reMZ0pYpaIyuIk/BMKP7GdELEyUyxIK/PAQU4mWogS+ocz4RALTCLJ749zZ5ghMLteMHQ9VzapG2kuF5h/Dgfe7lbQe6NQ5dJgFbz0rlvOEJnSFTZ9GI/p1w1Ps+ybeGOwtVR3Tnknoh5+mNF5TSJVoRrLzgtwQnINaIQY2kisW2KhzKwcUHIGQyEBSx2k+JpVbNK96P7ZLFk/v9uGh/mKiQIQKAl4/WB8SzTJ8vYDNZAdP8DjnQ1/o34EkQNd/P7WtTAe32EDFsGPvfVror/l+QAEXiICEL/sH19xfA6hcdrwT/Nh7DLAVBBh8CHlRgAiiHfSL8dN14VLEhobZ3D7+j1Zb4JjBiWssgQwJ6RJwqx//4yLxm8fVk4dsqGG8As0AkgOWR0cQQO/sLYEPN7PgV/IwDJNAUhH2MvoTXxB8NSARFLlVnyJVVwf+q1QMgJWiYEEdTSoKUwGu7P7HOZky12lMVhFjyO+b3tHm5ub+61Zk8EkpZhmPXiUtHAdxIDrf+GdIoImcAh2/guPeyEWkdHfWrimdWa2G7VKpVDkRlSbxFCBxgpiLLPdrlUrhVyGnUQ5VgeKS45EVPT46K8OKkUew9eVkAPoZkiCny8r/FgtCQRWUSHDOu9XQDY2jvv9Pb9jfM14wECXxVx8ufr26/f9X5BRnieAGxQPA94AdoFiOPngTl0qZW+eaTwziN+PIP7KnQFU8JRcwuNM5dMIzdgP4EdrfMcNdDpL6DRoCMkZifi8N1qIowZzMibR7wKTHQjOMY+/3+MdIBNugT3UmMbt6aITBH/on+2GHwAQqOWqUCD62xHPnylicvj5eHKsDZkmwwTzX+n2F2v+uQ1vqyKeHqx24A6U79/8vPm0pnP4YS6Ij8Q5lUnHQMl2ryjkwpsQbkeyLpQZvUW5LXjK3zG0WOB6pmK9BjeaM8Jotut0RZYmXG9Vcgq0bWE0o6suWRpU6YzQJl+1JZluV+4GZ7k9qLp00kvStDtywruh54q1rnvDPus2Kjn/a2E6HCpyOXwYzYBjE0vTvxPSSnzOLxV10geGHJfm/1aS4klZUQgXTVtJJWeA/wFPmR833RRQSAAAAABJRU5ErkJggg==")}function Wt(t="mark"){return qt(t,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAOVJREFUWEftluEOwjAIhNcnNz55Tac1swHuTpo1mu3nwnofB6OUbfFTFutvF8DPOFDJXpETYj6otd4p/VJuYxw8HwXQ4hbhAcjViQBS4kegF4ipdQpAg/EgPIBp2SMnpgO0TL2mtVywANzso8Op38QohQTAikRxowv/DzCW7XQHpgF804DWNykHFAhGfB9QRseGQwhB9PlvzYL0HOiwxq33zkMZQp4D7f3UUbz0MorEIwe6pSknkDgDsJfjWRNuKxr6BC080lpOucFsQR9XtHjBMMspzDoDIPLicIkWH6dHXADLHXgASmZzISXNKJcAAAAASUVORK5CYIIA")}function Xt(t){return Ut.sprites.get(t)}function Zt(t){return Ut.sounds.get(t)}function _t(t){return Ut.fonts.get(t)}function $t(t){return Ut.bitmapFonts.get(t)}function te(t){return Ut.shaders.get(t)}function ee(t){if("string"==typeof t){let e=Xt(t);if(e)return e;if(Mt()<1)return null;throw new Error(`Sprite not found: ${t}`)}if(t instanceof C)return dt.loaded(t);if(t instanceof dt)return t;throw new Error(`Invalid sprite: ${t}`)}function re(t){if("string"==typeof t){let e=Zt(t);if(e)return e.data?e.data:e;if(Mt()<1)return null;throw new Error(`Sound not found: ${t}`)}if(t instanceof K)return t;if(t instanceof dt)return t.data?t.data:t;throw new Error(`Invalid sound: ${t}`)}function ie(t){if(!t)return b.defShader;if("string"==typeof t){let e=te(t);if(e)return e.data?e.data:e;if(Mt()<1)return null;throw new Error(`Shader not found: ${t}`)}return t instanceof dt&&t.data?t.data:t}function ne(t){var r;if(!t)return ne(null!==(r=e.font)&&void 0!==r?r:"sink");if("string"==typeof t){let e=$t(t);if(e)return e.data?e.data:e;if(document.fonts.check(`64px ${t}`))return t;if(Mt()<1)return null;throw new Error(`Font not found: ${t}`)}return t instanceof dt&&t.data?t.data:t}function oe(t){return void 0!==t&&(X.masterNode.gain.value=a(t,0,3)),X.masterNode.gain.value}function se(t,e={loop:!1,volume:1,speed:1,detune:0,seek:0}){let i=re(t);if(i instanceof dt){let t=se(new K(Tt())),n=r((r=>{let i=se(r,e);for(let e in i)t[e]=i[e]}),"doPlay");return i.onLoad(n),t}if(null===i){let t=se(new K(Tt()));return Li((()=>{})),t}let n=X.ctx,o=!1,s=n.createBufferSource();s.buffer=i.buf,s.loop=!!e.loop;let l=n.createGain();var u;s.connect(l),l.connect(X.masterNode);let h=null!==(u=e.seek)&&void 0!==u?u:0;s.start(0,h);let d=n.currentTime-h,c=null,A={stop(){o||(this.pause(),d=n.currentTime)},play(t){if(!o)return;let e=s;s=n.createBufferSource(),s.buffer=e.buffer,s.loop=e.loop,s.playbackRate.value=e.playbackRate.value,s.detune&&(s.detune.value=e.detune.value),s.connect(l);let r=null!=t?t:this.time();s.start(0,r),d=n.currentTime-r,o=!1,c=null},pause(){o||(s.stop(),o=!0,c=n.currentTime)},isPaused:()=>o,isStopped:()=>o,speed:t=>(void 0!==t&&(s.playbackRate.value=a(t,0,3)),s.playbackRate.value),detune:t=>s.detune?(void 0!==t&&(s.detune.value=a(t,-1200,1200)),s.detune.value):0,volume:t=>(void 0!==t&&(l.gain.value=a(t,0,3)),l.gain.value),loop(){s.loop=!0},unloop(){s.loop=!1},duration:()=>i.buf.duration,time:()=>o?c-d:n.currentTime-d};return A.speed(e.speed),A.detune(e.detune),A.volume(e.volume),A}function ae(t){return se(X.burpSnd,t)}function le(t=mt,e=Vt){let n=pt.replace("{{user}}",null!=t?t:mt),o=gt.replace("{{user}}",null!=e?e:Vt),s=d.createShader(d.VERTEX_SHADER),a=d.createShader(d.FRAGMENT_SHADER);d.shaderSource(s,n),d.shaderSource(a,o),d.compileShader(s),d.compileShader(a);let l=d.createProgram();if(i.push((()=>d.deleteProgram(l))),d.attachShader(l,s),d.attachShader(l,a),d.bindAttribLocation(l,0,"a_pos"),d.bindAttribLocation(l,1,"a_uv"),d.bindAttribLocation(l,2,"a_color"),d.linkProgram(l),!d.getProgramParameter(l,d.LINK_STATUS)){let t=r((t=>{let e=t.match(/^ERROR:\s0:(?<line>\d+):\s(?<msg>.+)/);return{line:Number(e.groups.line),msg:e.groups.msg.replace(/\n\0$/,"")}}),"formatShaderError"),e=d.getShaderInfoLog(s),i=d.getShaderInfoLog(a),n="";if(e){let r=t(e);n+=`Vertex shader line ${r.line-14}: ${r.msg}`}if(i){let e=t(i);n+=`Fragment shader line ${e.line-14}: ${e.msg}`}throw new Error(n)}return d.deleteShader(s),d.deleteShader(a),{bind(){d.useProgram(l)},unbind(){d.useProgram(null)},free(){d.deleteProgram(l)},send(t){for(let e in t){let r=t[e],i=d.getUniformLocation(l,e);"number"==typeof r?d.uniform1f(i,r):r instanceof E?d.uniformMatrix4fv(i,!1,new Float32Array(r.m)):r instanceof m?d.uniform3f(i,r.r,r.g,r.b):r instanceof f?d.uniform3f(i,r.x,r.y,r.z):r instanceof c&&d.uniform2f(i,r.x,r.y)}}}}function ue(t,e,r,i){let n=t.width/e,o={},s=i.split("").entries();for(let[t,i]of s)o[i]=new v(t%n*e,Math.floor(t/n)*r,e,r);return{tex:t,map:o,size:r}}function he(t,e,r,i=b.defTex,n=b.defShader,o={}){let s=ie(n);if(s&&!(s instanceof dt)){(i!==b.curTex||s!==b.curShader||!W(b.curUniform,o)||b.vqueue.length+t.length*At>ft||b.iqueue.length+e.length>12288)&&de();for(let e of t){let t=fe((r?b.transform:It.cam.transform.mult(b.transform)).multVec2(e.pos.xy()));b.vqueue.push(t.x,t.y,e.pos.z,e.uv.x,e.uv.y,e.color.r/255,e.color.g/255,e.color.b/255,e.opacity)}for(let r of e)b.iqueue.push(r+b.vqueue.length/At-t.length);b.curTex=i,b.curShader=s,b.curUniform=o}}function de(){!b.curTex||!b.curShader||0===b.vqueue.length||0===b.iqueue.length||(d.bindBuffer(d.ARRAY_BUFFER,b.vbuf),d.bufferSubData(d.ARRAY_BUFFER,0,new Float32Array(b.vqueue)),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,b.ibuf),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(b.iqueue)),b.curShader.bind(),b.curShader.send(b.curUniform),b.curTex.bind(),d.drawElements(d.TRIANGLES,b.iqueue.length,d.UNSIGNED_SHORT,0),b.curTex.unbind(),b.curShader.unbind(),d.bindBuffer(d.ARRAY_BUFFER,null),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null),b.vqueue=[],b.iqueue=[],b.drawCalls++)}function ce(){ze(),d.clear(d.COLOR_BUFFER_BIT),e.background||Ge((()=>{Se({width:je(),height:We(),quad:new v(0,0,je()/64,We()/64),tex:b.bgTex,fixed:!0})})),b.drawCalls=0,b.transformStack=[],b.transform=new E}function Ae(){de(),b.lastDrawCalls=b.drawCalls}function fe(t){return A(t.x/je()*2-1,-t.y/We()*2+1)}function pe(t){b.transform=t.clone()}function ge(...t){if(void 0===t[0])return;let e=A(...t);0===e.x&&0===e.y||(b.transform=b.transform.translate(e))}function me(...t){if(void 0===t[0])return;let e=A(...t);1===e.x&&1===e.y||(b.transform=b.transform.scale(e))}function Ve(t){!t||(b.transform=b.transform.rotateX(t))}function we(t){!t||(b.transform=b.transform.rotateY(t))}function ve(t){!t||(b.transform=b.transform.rotateZ(t))}r(Ft,"load"),r(Mt,"loadProgress"),r(Ct,"loadRoot"),r(Pt,"fetchURL"),r(kt,"fetchJSON"),r(Dt,"fetchText"),r(Lt,"fetchArrayBuffer"),r(Nt,"loadImg"),r(Gt,"loadFont"),r(Qt,"loadBitmapFont"),r(Yt,"slice"),r(Kt,"loadSpriteAtlas"),r(qt,"loadSprite"),r(Ot,"loadPedit"),r(Ht,"loadAseprite"),r(Jt,"loadShader"),r(zt,"loadSound"),r(jt,"loadBean"),r(Wt,"loadMark"),r(Xt,"getSprite"),r(Zt,"getSound"),r(_t,"getFont"),r($t,"getBitmapFont"),r(te,"getShader"),r(ee,"resolveSprite"),r(re,"resolveSound"),r(ie,"resolveShader"),r(ne,"resolveFont"),r(oe,"volume"),r(se,"play"),r(ae,"burp"),r(le,"makeShader"),r(ue,"makeFont"),r(he,"drawRaw"),r(de,"flush"),r(ce,"frameStart"),r(Ae,"frameEnd"),r(fe,"screen2ndc"),r(pe,"pushMatrix"),r(ge,"pushTranslate"),r(me,"pushScale"),r(Ve,"pushRotateX"),r(we,"pushRotateY"),r(ve,"pushRotateZ");let ye=ve;function Ee(){b.transformStack.push(b.transform.clone())}function xe(){b.transformStack.length>0&&(b.transform=b.transformStack.pop())}function Se(t){if(void 0===t.width||void 0===t.height)throw new Error('drawUVQuad() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;var e;let r=t.width,i=t.height,n=bt(t.anchor||"topleft").scale(A(r,i).scale(-.5)),o=t.quad||new v(0,0,1,1),s=t.color||V(255,255,255),a=null!==(e=t.opacity)&&void 0!==e?e:1,l=t.tex?.05/t.tex.width:0,u=t.tex?.05/t.tex.height:0,h=o.x+l,d=o.y+u,c=o.w-2*l,f=o.h-2*u;Ee(),ge(t.pos),ve(t.angle),me(t.scale),ge(n),he([{pos:p(-r/2,i/2,0),uv:A(t.flipX?h+c:h,t.flipY?d:d+f),color:s,opacity:a},{pos:p(-r/2,-i/2,0),uv:A(t.flipX?h+c:h,t.flipY?d+f:d),color:s,opacity:a},{pos:p(r/2,-i/2,0),uv:A(t.flipX?h:h+c,t.flipY?d+f:d),color:s,opacity:a},{pos:p(r/2,i/2,0),uv:A(t.flipX?h:h+c,t.flipY?d:d+f),color:s,opacity:a}],[0,1,3,1,2,3],t.fixed,t.tex,t.shader,t.uniform),xe()}function be(t){if(!t.tex)throw new Error('drawTexture() requires property "tex".');var e;let r=null!==(e=t.quad)&&void 0!==e?e:new v(0,0,1,1),i=t.tex.width*r.w,n=t.tex.height*r.h,o=A(1);if(t.tiled){let e=Math.ceil((t.width||i)/i),s=Math.ceil((t.height||n)/n),a=bt(t.anchor||"topleft").add(A(1,1)).scale(.5).scale(e*i,s*n);for(let l=0;l<e;l++)for(let e=0;e<s;e++)Se({...t,pos:(t.pos||A(0)).add(A(i*l,n*e)).sub(a),scale:o.scale(t.scale||A(1)),tex:t.tex,quad:r,width:i,height:n,anchor:"topleft"})}else t.width&&t.height?(o.x=t.width/i,o.y=t.height/n):t.width?(o.x=t.width/i,o.y=o.x):t.height&&(o.y=t.height/n,o.x=o.y),Se({...t,scale:o.scale(t.scale||A(1)),tex:t.tex,quad:r,width:i,height:n})}function Re(t){if(!t.sprite)throw new Error('drawSprite() requires property "sprite"');let e=ee(t.sprite);if(!e||!e.data)return;var r;let i=e.data.frames[null!==(r=t.frame)&&void 0!==r?r:0];var n;if(!i)throw new Error(`Frame not found: ${null!==(n=t.frame)&&void 0!==n?n:0}`);be({...t,tex:e.data.tex,quad:i.scale(t.quad||new v(0,0,1,1))})}function Te(t,e,r,i,n,s=1){i=o(i%360),(n=o(n%360))<=i&&(n+=2*Math.PI);let a=(n-i)/Math.ceil(Math.max(3*Math.sqrt(e+r)*(s||1),16)),l=[];for(let o=i;o<n;o+=a)l.push(t.add(e*Math.cos(o),r*Math.sin(o)));return l.push(t.add(e*Math.cos(n),r*Math.sin(n))),l}function Be(t){if(void 0===t.width||void 0===t.height)throw new Error('drawRect() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let e=t.width,r=t.height,i=bt(t.anchor||"topleft").add(1,1).scale(A(e,r).scale(-.5)),n=[A(0,0),A(e,0),A(e,r),A(0,r)];if(t.radius){let i=Math.min(Math.min(e,r)/2,t.radius);n=[A(i,0),A(e-i,0),...Te(A(e-i,i),i,i,270,360),A(e,i),A(e,r-i),...Te(A(e-i,r-i),i,i,0,90),A(e-i,r),A(i,r),...Te(A(i,r-i),i,i,90,180),A(0,r-i),A(0,i),...Te(A(i,i),i,i,180,270)]}Pe({...t,offset:i,pts:n,...t.gradient?{colors:t.horizontal?[t.gradient[0],t.gradient[1],t.gradient[1],t.gradient[0]]:[t.gradient[0],t.gradient[0],t.gradient[1],t.gradient[1]]}:{}})}function Ue(t){let{p1:e,p2:r}=t;if(!e||!r)throw new Error('drawLine() requires properties "p1" and "p2".');var i,n;let o=t.width||1,s=r.sub(e).unit().normal().scale(.5*o);he([e.sub(s),e.add(s),r.add(s),r.sub(s)].map((e=>({pos:p(e.x,e.y,0),uv:A(0),color:null!==(i=t.color)&&void 0!==i?i:m.WHITE,opacity:null!==(n=t.opacity)&&void 0!==n?n:1}))),[0,1,3,1,2,3],t.fixed,b.defTex,t.shader,t.uniform)}function Ie(t){let e=t.pts;if(!e)throw new Error('drawLines() requires property "pts".');if(!(e.length<2))if(t.radius&&e.length>=3){let r=e[0].dist(e[1]);for(let t=1;t<e.length-1;t++)r=Math.min(e[t].dist(e[t+1]),r);Math.min(t.radius,r/2);Ue({...t,p1:e[0],p2:e[1]});for(let r=1;r<e.length-2;r++){let i=e[r],n=e[r+1];Ue({...t,p1:i,p2:n})}Ue({...t,p1:e[e.length-2],p2:e[e.length-1]})}else for(let r=0;r<e.length-1;r++)Ue({...t,p1:e[r],p2:e[r+1]})}function Fe(t){if(!t.p1||!t.p2||!t.p3)throw new Error('drawPolygon() requires properties "p1", "p2" and "p3".');return Pe({...t,pts:[t.p1,t.p2,t.p3]})}function Me(t){if(!t.radius)throw new Error('drawCircle() requires property "radius".');0!==t.radius&&Ce({...t,radiusX:t.radius,radiusY:t.radius,angle:0})}function Ce(t){if(void 0===t.radiusX||void 0===t.radiusY)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(0===t.radiusX||0===t.radiusY)return;var e,r;let i=null!==(e=t.start)&&void 0!==e?e:0,n=null!==(r=t.end)&&void 0!==r?r:360,o=Te(A(0),t.radiusX,t.radiusY,i,n,t.resolution);o.unshift(A(0));let s={...t,pts:o,radius:0,...t.gradient?{colors:[t.gradient[0],...Array(o.length-1).fill(t.gradient[1])]}:{}};if(n-i>=360&&t.outline)return!1!==t.fill&&Pe({...s,outline:null}),void Pe({...s,pts:o.slice(1),fill:!1});Pe(s)}function Pe(t){if(!t.pts)throw new Error('drawPolygon() requires property "pts".');let e=t.pts.length;if(!(e<3)){if(Ee(),ge(t.pos),me(t.scale),ve(t.angle),ge(t.offset),!1!==t.fill){var r,i,n;let s=null!==(r=t.color)&&void 0!==r?r:m.WHITE,a=t.pts.map(((e,r)=>({pos:p(e.x,e.y,0),uv:A(0,0),color:t.colors&&null!==(i=t.colors[r])&&void 0!==i?i:s,opacity:null!==(n=t.opacity)&&void 0!==n?n:1}))),l=[...Array(e-2).keys()].map((t=>[0,t+1,t+2])).flat();var o;he(a,null!==(o=t.indices)&&void 0!==o?o:l,t.fixed,b.defTex,t.shader,t.uniform)}t.outline&&Ie({pts:[...t.pts,t.pts[0]],radius:t.radius,width:t.outline.width,color:t.outline.color,uniform:t.uniform,fixed:t.fixed}),xe()}}function ke(t,e,r){de(),d.clear(d.STENCIL_BUFFER_BIT),d.enable(d.STENCIL_TEST),d.stencilFunc(d.NEVER,1,255),d.stencilOp(d.REPLACE,d.REPLACE,d.REPLACE),e(),de(),d.stencilFunc(r,1,255),d.stencilOp(d.KEEP,d.KEEP,d.KEEP),t(),de(),d.disable(d.STENCIL_TEST)}function De(t,e){ke(t,e,d.EQUAL)}function Le(t,e){ke(t,e,d.NOTEQUAL)}function Ne(){return(b.viewport.width+b.viewport.height)/(b.width+b.height)}function Ge(t){de();let e=b.width,r=b.height;b.width=b.viewport.width,b.height=b.viewport.height,t(),de(),b.width=e,b.height=r}function Qe(t,e){e.pos&&(t.pos=t.pos.add(e.pos)),e.scale&&(t.scale=t.scale.scale(A(e.scale))),e.angle&&(t.angle+=e.angle),e.color&&(t.color=t.color.mult(e.color)),e.opacity&&(t.opacity*=e.opacity)}r(Ee,"pushTransform"),r(xe,"popTransform"),r(Se,"drawUVQuad"),r(be,"drawTexture"),r(Re,"drawSprite"),r(Te,"getArcPts"),r(Be,"drawRect"),r(Ue,"drawLine"),r(Ie,"drawLines"),r(Fe,"drawTriangle"),r(Me,"drawCircle"),r(Ce,"drawEllipse"),r(Pe,"drawPolygon"),r(ke,"drawStenciled"),r(De,"drawMasked"),r(Le,"drawSubtracted"),r(Ne,"getViewportScale"),r(Ge,"drawUnscaled"),r(Qe,"applyCharTransform");let Ye=/\[(?<text>[^\]]*)\]\.(?<style>[\w\.]+)+/g;function Ke(t){let e={},r=t.replace(Ye,"$1"),i=0;for(let r of t.matchAll(Ye)){let t=r.groups.style.split("."),n=r.index-i;for(let i=n;i<r.index+r.groups.text.length;i++)e[i]={localIdx:i-n,styles:t};i+=3+r.groups.style.length}return{charStyleMap:e,text:r}}r(Ke,"compileStyledText");let qe={};function Oe(t){if(void 0===t.text)throw new Error('formatText() requires property "text".');let e=ne(t.font);if(""===t.text||e instanceof dt||!e)return{width:0,height:0,chars:[],opt:t};let{charStyleMap:r,text:i}=Ke(t.text+""),o=i.split("");if(e instanceof FontFace||"string"==typeof e){var s;let t=e instanceof FontFace?e.family:e,r=null!==(s=qe[t])&&void 0!==s?s:{font:{tex:new g(1024,1024),map:{},size:64},cursor:A(0)};qe[t]||(qe[t]=r),e=r.font;for(let i of o)if(!r.font.map[i]){let o=n.canvas2.getContext("2d");o.font=`${e.size}px ${t}`,o.clearRect(0,0,n.canvas2.width,n.canvas2.height),o.textBaseline="top",o.textAlign="left",o.fillStyle="rgb(255, 255, 255)",o.fillText(i,0,0);let s=o.measureText(i),a=Math.ceil(s.width),l=o.getImageData(0,0,a,e.size);if(r.cursor.x+a>1024&&(r.cursor.x=0,r.cursor.y+=e.size,r.cursor.y>1024))throw new Error("Font atlas exceeds character limit");e.tex.update(r.cursor.x,r.cursor.y,l),e.map[i]=new v(r.cursor.x,r.cursor.y,a,e.size),r.cursor.x+=a}}var a,l,u;let h=t.size||e.size,d=A(null!==(a=t.scale)&&void 0!==a?a:1).scale(h/e.size),f=null!==(l=t.lineSpacing)&&void 0!==l?l:0,p=null!==(u=t.letterSpacing)&&void 0!==u?u:0,V=0,w=0,y=0,E=[],x=[],S=0,b=null,R=null;for(;S<o.length;){let r=o[S];if("\n"===r)y+=h+f,E.push({width:V-p,chars:x}),b=null,R=null,V=0,x=[];else{let i=e.map[r];if(i){let n=i.w*d.x;var T,B;t.width&&V+n>t.width&&(y+=h+f,null!=b&&(S-=x.length-b,r=o[S],i=e.map[r],n=i.w*d.x,x=x.slice(0,b-1),V=R),b=null,R=null,E.push({width:V-p,chars:x}),V=0,x=[]),x.push({tex:e.tex,width:i.w,height:i.h,quad:new v(i.x/e.tex.width,i.y/e.tex.height,i.w/e.tex.width,i.h/e.tex.height),ch:r,pos:A(V,y),opacity:null!==(T=t.opacity)&&void 0!==T?T:1,color:null!==(B=t.color)&&void 0!==B?B:m.WHITE,scale:A(d),angle:0})," "===r&&(b=x.length,R=V),V+=n,w=Math.max(w,V),V+=p}}S++}E.push({width:V-p,chars:x}),y+=h,t.width&&(w=t.width);let U=[];for(let i of E){var I;let n=(w-i.width)*Rt(null!==(I=t.align)&&void 0!==I?I:"left");for(let o of i.chars){let i=e.map[o.ch],s=U.length,a=new c(i.w*d.x*.5,i.h*d.y*.5);if(o.pos=o.pos.add(n,0).add(a),t.transform){let e="function"==typeof t.transform?t.transform(s,o.ch):t.transform;e&&Qe(o,e)}if(r[s]){let{styles:e,localIdx:i}=r[s];for(let r of e){let e=t.styles[r],n="function"==typeof e?e(i,o.ch):e;n&&Qe(o,n)}}U.push(o)}}return{width:w,height:y,chars:U,opt:t}}function He(t){Je(Oe(t))}function Je(t){var e;Ee(),ge(t.opt.pos),ve(t.opt.angle),ge(bt(null!==(e=t.opt.anchor)&&void 0!==e?e:"topleft").add(1,1).scale(t.width,t.height).scale(-.5)),t.chars.forEach((e=>{Se({tex:e.tex,width:e.width,height:e.height,pos:e.pos,scale:e.scale,angle:e.angle,color:e.color,opacity:e.opacity,quad:e.quad,anchor:"center",uniform:t.opt.uniform,shader:t.opt.shader,fixed:t.opt.fixed})})),xe()}function ze(){if(n.stretchToParent&&!vr()){let t=n.canvas.parentElement.offsetWidth,e=n.canvas.parentElement.offsetHeight;if(t!==n.lastParentWidth||e!==n.lastParentHeight){n.canvas.width=t*n.pixelDensity,n.canvas.height=e*n.pixelDensity,n.canvas.style.width=t+"px",n.canvas.style.height=e+"px";let r=je(),i=We();It.ev.onOnce("frameEnd",(()=>{It.ev.trigger("resize",r,i,je(),We())}))}n.lastParentWidth=t,n.lastParentHeight=e}let t=n.pixelDensity,r=d.drawingBufferWidth/t,i=d.drawingBufferHeight/t;if(vr()){let t=window.innerWidth,e=window.innerHeight,n=r/i;if(t/e>n){let r=window.innerHeight*n;b.viewport={x:(t-r)/2,y:0,width:r,height:e}}else{let r=window.innerWidth/n;b.viewport={x:0,y:(e-r)/2,width:t,height:r}}return}if(e.letterbox){if(!e.width||!e.height)throw new Error("Letterboxing requires width and height defined.");let n=r/i,o=e.width/e.height;if(n>o){e.stretch||(b.width=i*o,b.height=i);let n=i*o,s=i,a=(r-n)/2;d.scissor(a*t,0,n*t,s*t),d.viewport(a*t,0,n*t,i*t),b.viewport={x:a,y:0,width:n,height:i}}else{e.stretch||(b.width=r,b.height=r/o);let n=r,s=r/o,a=(i-s)/2;d.scissor(0,a*t,n*t,s*t),d.viewport(0,a*t,r*t,s*t),b.viewport={x:0,y:a,width:r,height:s}}return}if(e.stretch){if(!e.width||!e.height)throw new Error("Stretching requires width and height defined.");return d.viewport(0,0,r*t,i*t),void(b.viewport={x:0,y:0,width:r,height:i})}var o;let s=null!==(o=e.scale)&&void 0!==o?o:1;b.width=r/s,b.height=i/s,d.viewport(0,0,r*t,i*t),b.viewport={x:0,y:0,width:r,height:i}}function je(){return b.width}function We(){return b.height}r(Oe,"formatText"),r(He,"drawText"),r(Je,"drawFormattedText"),r(ze,"updateViewport"),r(je,"width"),r(We,"height");let Xe={},Ze={},_e={};function $e(t){return A((t.x-b.viewport.x)*je()/b.viewport.width,(t.y-b.viewport.y)*We()/b.viewport.height)}function tr(t){return A(t.x*b.viewport.width/b.width,t.y*b.viewport.height/b.height)}function er(t,e){let r=$e(A(t,e));n.mouseStarted&&(n.mouseDeltaPos=r.sub(n.mousePos)),n.mousePos=r,n.mouseStarted=!0,n.isMouseMoved=!0}r($e,"windowToContent"),r(tr,"contentToView"),r(er,"setMousePos"),Xe.mousemove=t=>{er(t.offsetX,t.offsetY)},Xe.mousedown=t=>{let e=lt[t.button];e&&(n.mouseStates[e]="pressed")},Xe.mouseup=t=>{let e=lt[t.button];e&&(n.mouseStates[e]="released")},Xe.keydown=t=>{let e=at[t.key]||t.key.toLowerCase();ut.includes(e)&&t.preventDefault(),1===e.length&&n.charInputted.push(t.key),"space"===e&&n.charInputted.push(" "),t.repeat?(n.isKeyPressedRepeat=!0,n.keyStates[e]="rpressed"):(n.isKeyPressed=!0,n.keyStates[e]="pressed"),n.numKeyDown++},Xe.keyup=t=>{let e=at[t.key]||t.key.toLowerCase();n.keyStates[e]="released",n.isKeyReleased=!0,n.numKeyDown--},Xe.touchstart=t=>{t.preventDefault();let r=[...t.changedTouches];r.forEach((t=>{It.ev.trigger("onTouchStart",$e(A(t.clientX,t.clientY)),t)})),!1!==e.touchToMouse&&(er(r[0].clientX,r[0].clientY),n.mouseStates.left="pressed")},Xe.touchmove=t=>{t.preventDefault();let r=[...t.changedTouches];r.forEach((t=>{It.ev.trigger("onTouchMove",$e(A(t.clientX,t.clientY)),t)})),!1!==e.touchToMouse&&er(r[0].clientX,r[0].clientY)},Xe.touchend=t=>{[...t.changedTouches].forEach((t=>{It.ev.trigger("onTouchEnd",$e(A(t.clientX,t.clientY)),t)})),!1!==e.touchToMouse&&(n.mouseStates.left="released")},Xe.touchcancel=()=>{!1!==e.touchToMouse&&(n.mouseStates.left="released")},Xe.contextmenu=function(t){t.preventDefault()},Ze.visibilitychange=()=>{switch(document.visibilityState){case"visible":n.skipTime=!0,yr.paused||X.ctx.resume();break;case"hidden":X.ctx.suspend()}},_e.error=t=>{t.error?gn(t.error):gn(new Error(t.message))},_e.unhandledrejection=t=>gn(t.reason);for(let t in Xe)n.canvas.addEventListener(t,Xe[t]);for(let t in Ze)document.addEventListener(t,Ze[t]);for(let t in _e)window.addEventListener(t,_e[t]);function rr(){return n.mousePos.clone()}function ir(){return n.mouseDeltaPos.clone()}function nr(t="left"){return"pressed"===n.mouseStates[t]}function or(t="left"){return"pressed"===n.mouseStates[t]||"down"===n.mouseStates[t]}function sr(t="left"){return"released"===n.mouseStates[t]}function ar(){return n.isMouseMoved}function lr(t){return void 0===t?n.isKeyPressed:"pressed"===n.keyStates[t]}function ur(t){return void 0===t?n.isKeyPressedRepeat:"pressed"===n.keyStates[t]||"rpressed"===n.keyStates[t]}function hr(t){return void 0===t?n.numKeyDown>0:"pressed"===n.keyStates[t]||"rpressed"===n.keyStates[t]||"down"===n.keyStates[t]}function dr(t){return void 0===t?n.isKeyReleased:"released"===n.keyStates[t]}function cr(t){return"pressed"===n.virtualButtonStates[t]}function Ar(t){return"pressed"===n.virtualButtonStates[t]||"down"===n.virtualButtonStates[t]}function fr(t){return"released"===n.virtualButtonStates[t]}function pr(){return[...n.charInputted]}function gr(){return n.time}function mr(){return n.canvas.toDataURL()}function Vr(t){return t&&(n.canvas.style.cursor=t),n.canvas.style.cursor}function wr(t=!0){t?Et(n.canvas):xt()}function vr(){return Boolean(St())}r(rr,"mousePos"),r(ir,"mouseDeltaPos"),r(nr,"isMousePressed"),r(or,"isMouseDown"),r(sr,"isMouseReleased"),r(ar,"isMouseMoved"),r(lr,"isKeyPressed"),r(ur,"isKeyPressedRepeat"),r(hr,"isKeyDown"),r(dr,"isKeyReleased"),r(cr,"isVirtualButtonPressed"),r(Ar,"isVirtualButtonDown"),r(fr,"isVirtualButtonReleased"),r(pr,"charInputted"),r(gr,"time"),r(mr,"screenshot"),r(Vr,"setCursor"),r(wr,"setFullscreen"),r(vr,"isFullscreen");let yr={inspect:!1,timeScale:1,showLog:!0,fps:()=>n.fpsCounter.fps,numFrames:()=>n.numFrames,stepFrame:on,drawCalls:()=>b.drawCalls,clearLog:()=>It.logs=[],log:t=>{var r;let i=null!==(r=e.logMax)&&void 0!==r?r:1;It.logs.unshift(`${e.logTime?`[${gr().toFixed(2)}].time `:""}[${(null==t?void 0:t.toString)?t.toString():t}].${t instanceof Error?"error":"info"}`),It.logs.length>i&&(It.logs=It.logs.slice(0,i))},error:t=>yr.log(new Error(t.toString?t.toString():t)),curRecording:null,get paused(){return n.paused},set paused(t){n.paused=t,t?X.ctx.suspend():X.ctx.resume()}};function Er(){return n.dt*yr.timeScale}function xr(...t){return t.length>0&&(It.cam.pos=A(...t)),It.cam.pos.clone()}function Sr(...t){return t.length>0&&(It.cam.scale=A(...t)),It.cam.scale.clone()}function br(t){return void 0!==t&&(It.cam.angle=t),It.cam.angle}function Rr(t=12){It.cam.shake=t}function Tr(t){return It.cam.transform.multVec2(t)}function Br(t){return It.cam.transform.invert().multVec2(t)}function Ur(t){let e=new E;return t.pos&&(e=e.translate(t.pos)),t.scale&&(e=e.scale(t.scale)),t.angle&&(e=e.rotateZ(t.angle)),t.parent?e.mult(t.parent.transform):e}function Ir(t){let e=new Map,i={},n=new j,o={id:it(),hidden:!1,paused:!1,transform:new E,children:[],parent:null,add(t){let e=(()=>{if(Array.isArray(t))return Ir(t);if(t.parent)throw new Error("Cannot add a game obj that already has a parent.");return t})();return e.parent=this,e.transform=Ur(e),this.children.push(e),e.trigger("add",this),It.ev.trigger("add",this),e},readd(t){let e=this.children.indexOf(t);return-1!==e&&(this.children.splice(e,1),this.children.push(t)),t},remove(t){let e=this.children.indexOf(t);-1!==e&&(t.parent=null,t.trigger("destroy"),It.ev.trigger("destroy",t),this.children.splice(e,1))},removeAll(t){this.get(t).forEach((t=>this.remove(t)))},update(){this.paused||(this.get().forEach((t=>t.update())),this.trigger("update"))},draw(){this.hidden||(Ee(),ge(this.pos),me(this.scale),ve(this.angle),this.get().forEach((t=>t.draw())),this.trigger("draw"),xe())},drawInspect(){this.hidden||(Ee(),ge(this.pos),me(this.scale),ve(this.angle),this.get().forEach((t=>t.drawInspect())),this.trigger("drawInspect"),xe())},use(t){if(!t)return;if("string"==typeof t)return this.use({id:t});t.id&&(this.unuse(t.id),e.set(t.id,{cleanups:[]}));let n=t.id?e.get(t.id):i,o=t.id?n.cleanups:[],s=r((()=>{if(t.require)for(let e of t.require)if(!this.c(e))throw new Error(`Component "${t.id}" requires component "${e}"`)}),"checkDeps");t.destroy&&o.push(t.destroy),t.require&&!this.exists()&&n.cleanups&&o.push(this.on("add",s));for(let e in t)if(!wt.has(e)){if("function"==typeof t[e]){let r=t[e].bind(this);if(vt.has(e)){o.push(this.on(e,r)),n[e]=r;continue}n[e]=r}else n[e]=t[e];if(void 0!==this[e])throw new Error(`Duplicate component property: "${e}"`);Object.defineProperty(this,e,{get:()=>n[e],set:t=>n[e]=t,configurable:!0,enumerable:!0})}this.exists()&&(s(),t.add&&t.add.call(this))},unuse(t){if(e.has(t)){let r=e.get(t);r.cleanups.forEach((t=>t()));for(let t in r)delete r[t]}e.delete(t)},c:t=>e.get(t),get(t){var e,r;return this.children.filter((e=>!t||e.is(t))).sort(((t,i)=>(null!==(e=t.z)&&void 0!==e?e:0)-(null!==(r=i.z)&&void 0!==r?r:0)))},getAll(t){var e,r;return this.children.sort(((t,i)=>(null!==(e=t.z)&&void 0!==e?e:0)-(null!==(r=i.z)&&void 0!==r?r:0))).flatMap((e=>[e,...e.getAll(t)])).filter((e=>!t||e.is(t)))},isAncestorOf(t){return!!t.parent&&(t.parent===this||this.isAncestorOf(t.parent))},exists(){return It.root.isAncestorOf(this)},is(t){if("*"===t)return!0;if(Array.isArray(t)){for(let e of t)if(!this.c(e))return!1;return!0}return null!=this.c(t)},on(t,e){return n.on(t,e.bind(this))},trigger(t,...e){n.trigger(t,...e),It.objEvents.trigger(t,this,...e)},destroy(){if(!this.parent)throw new Error("Cannot destroy parentless object.");this.parent.remove(this)},inspect(){let t={};for(let[r,i]of e)t[r]=i.inspect?i.inspect():null;return t},onAdd(t){return this.on("add",t)},onUpdate(t){return this.on("update",t)},onDraw(t){return this.on("draw",t)},onDestroy(t){return this.on("destroy",t)},clearEvents(){n.clear()}};for(let e of t)o.use(e);return o}function Fr(t,e,r){return It.objEvents[t]||(It.objEvents[t]=new J),It.objEvents.on(t,((t,...i)=>{t.is(e)&&r(t,...i)}))}function Mr(t,e){if("function"==typeof t&&void 0===e){let e=Wi([{update:t}]);return()=>e.destroy()}if("string"==typeof t)return Fr("update",t,e)}function Cr(t,e){if("function"==typeof t&&void 0===e){let e=Wi([{draw:t}]);return()=>e.destroy()}if("string"==typeof t)return Fr("draw",t,e)}function Pr(t,e){if("function"==typeof t&&void 0===e){let e=Wi([{draw:t}]);return()=>e.destroy()}if("string"==typeof t)return Fr("add",t,e)}function kr(t,e){if("function"==typeof t&&void 0===e){let e=Wi([{draw:t}]);return()=>e.destroy()}if("string"==typeof t)return Fr("destroy",t,e)}function Dr(t,e,r){return Fr("collide",t,((t,i,n)=>i.is(e)&&r(t,i,n)))}function Lr(t,e){_i(t).forEach(e),Pr(t,e)}function Nr(t,e){if("function"==typeof t)return Wr(t);{let r=[];return Lr(t,(t=>{if(!t.area)throw new Error("onClick() requires the object to have area() component");r.push(t.onClick((()=>e(t))))})),()=>r.forEach((t=>t()))}}function Gr(t,e){let r=[];return Lr(t,(t=>{if(!t.area)throw new Error("onHover() requires the object to have area() component");r.push(t.onHover((()=>e(t))))})),()=>r.forEach((t=>t()))}function Qr(t,e){let r=[];return Lr(t,(t=>{if(!t.area)throw new Error("onHoverUpdate() requires the object to have area() component");r.push(t.onHoverUpdate((()=>e(t))))})),()=>r.forEach((t=>t()))}function Yr(t,e){let r=[];return Lr(t,(t=>{if(!t.area)throw new Error("onHoverEnd() requires the object to have area() component");r.push(t.onHoverEnd((()=>e(t))))})),()=>r.forEach((t=>t()))}function Kr(t,e){return new Promise((r=>{It.timers.push(new ot(t,(()=>{e&&e(),r()})))}))}function qr(t,e){let i=!1,n=r((()=>{i||(e(),Kr(t,n))}),"newF");return n(),()=>i=!0}function Or(t,e){if(Array.isArray(t)){let r=t.map((t=>Or(t,e)));return()=>r.forEach((t=>t()))}return It.ev.on("input",(()=>hr(t)&&e()))}function Hr(t,e){if(Array.isArray(t)){let r=t.map((t=>Hr(t,e)));return()=>r.forEach((t=>t()))}return"function"==typeof t?It.ev.on("input",(()=>lr()&&t())):It.ev.on("input",(()=>lr(t)&&e()))}function Jr(t,e){if(Array.isArray(t)){let r=t.map((t=>Jr(t,e)));return()=>r.forEach((t=>t()))}return"function"==typeof t?It.ev.on("input",(()=>lr()&&t())):It.ev.on("input",(()=>ur(t)&&e()))}function zr(t,e){if(Array.isArray(t)){let r=t.map((t=>zr(t,e)));return()=>r.forEach((t=>t()))}return"function"==typeof t?It.ev.on("input",(()=>dr()&&t())):It.ev.on("input",(()=>dr(t)&&e()))}function jr(t,e){return"function"==typeof t?It.ev.on("input",(()=>or()&&t(rr()))):It.ev.on("input",(()=>or(t)&&e(rr())))}function Wr(t,e){return"function"==typeof t?It.ev.on("input",(()=>nr()&&t(rr()))):It.ev.on("input",(()=>nr(t)&&e(rr())))}function Xr(t,e){return"function"==typeof t?It.ev.on("input",(()=>sr()&&t(rr()))):It.ev.on("input",(()=>sr(t)&&e(rr())))}function Zr(t){return It.ev.on("input",(()=>ar()&&t(rr(),ir())))}function _r(t){return It.ev.on("input",(()=>pr().forEach((e=>t(e)))))}function $r(t){return It.ev.on("onTouchStart",t)}function ti(t){return It.ev.on("onTouchMove",t)}function ei(t){return It.ev.on("onTouchEnd",t)}function ri(t,e){return It.ev.on("input",(()=>cr(t)&&e()))}function ii(t,e){return It.ev.on("input",(()=>Ar(t)&&e()))}function ni(t,e){return It.ev.on("input",(()=>fr(t)&&e()))}function oi(){Hr("f1",(()=>{yr.inspect=!yr.inspect})),Hr("f2",(()=>{yr.clearLog()})),Hr("f8",(()=>{yr.paused=!yr.paused})),Hr("f7",(()=>{yr.timeScale=ci(a(yr.timeScale-.2,0,2),1)})),Hr("f9",(()=>{yr.timeScale=ci(a(yr.timeScale+.2,0,2),1)})),Hr("f10",(()=>{yr.stepFrame()}))}function si(){Hr("b",ae)}function ai(t){return void 0!==t&&(It.gravity=t),It.gravity}function li(...t){return{id:"pos",pos:A(...t),moveBy(...t){this.pos=this.pos.add(A(...t))},move(...t){this.moveBy(A(...t).scale(Er()))},moveTo(...t){if("number"==typeof t[0]&&"number"==typeof t[1])return this.moveTo(A(t[0],t[1]),t[2]);let e=t[0],r=t[1];if(void 0===r)return void(this.pos=A(e));let i=e.sub(this.pos);i.len()<=r*Er()?this.pos=A(e):this.move(i.unit().scale(r))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){return this.fixed?this.pos:Tr(this.pos)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){Me({color:V(255,0,0),radius:4/Ne()})}}}function ui(...t){return 0===t.length?ui(1):{id:"scale",scale:A(...t),scaleTo(...t){this.scale=A(...t)},inspect(){return"number"==typeof this.scale?`${ci(this.scale,2)}`:`(${ci(this.scale.x,2)}, ${ci(this.scale.y,2)})`}}}function hi(t){return{id:"rotate",angle:null!=t?t:0,rotate(t){this.rotateBy(t*Er())},rotateBy(t){this.angle+=t},inspect(){return`${Math.round(this.angle)}`}}}function di(...t){return{id:"color",color:V(...t),inspect(){return this.color.toString()}}}function ci(t,e){return Number(t.toFixed(e))}function Ai(t){return{id:"opacity",opacity:null!=t?t:1,inspect(){return`${ci(this.opacity,2)}`}}}function fi(t){if(!t)throw new Error("Please define an anchor");return{id:"anchor",anchor:t,inspect(){return"string"==typeof this.anchor?this.anchor:this.anchor.toString()}}}function pi(t){return{id:"z",z:t,inspect(){return`${this.z}`}}}function gi(t,e){return{id:"follow",require:["pos"],follow:{obj:t,offset:null!=e?e:A(0)},add(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function mi(t,e){let r="number"==typeof t?c.fromAngle(t):t.unit();return{id:"move",require:["pos"],update(){this.move(r.scale(e))}}}function Vi(t={}){let e=0,r=!1;return{id:"outview",require:["pos","area"],isOutOfView(){var e;let r=A(null!==(e=t.offset)&&void 0!==e?e:0),i=Q.fromPoints(A(0,0).sub(r),A(je(),We()).add(r));return!F(this.screenArea().bbox(),i)},onExitView(t){return this.on("exitView",t)},onEnterView(t){return this.on("enterView",t)},update(){if(this.isOutOfView()){if(r||(this.trigger("exitView"),r=!0),t.delay&&(e+=Er(),e<t.delay))return;t.hide&&(this.hidden=!0),t.pause&&(this.paused=!0),t.destroy&&this.destroy()}else r&&(this.trigger("enterView"),r=!1),e=0,t.hide&&(this.hidden=!1),t.pause&&(this.paused=!1)},inspect(){return`${this.isOutOfView()}`}}}function wi(t={}){return{...Vi({destroy:!0,onExitView:t.onCleanup,offset:t.offset,delay:t.delay}),id:"cleanup"}}function vi(t={}){let e=[];var r,i,n,o,s;return{id:"area",colliding:{},collisionIgnore:null!==(r=t.collisionIgnore)&&void 0!==r?r:[],add(){this.area.cursor&&e.push(this.onHover((()=>Vr(this.area.cursor)))),e.push(this.onCollideUpdate(((t,e)=>{this.colliding[t.id]||this.trigger("collide",t,e),this.colliding[t.id]=e})))},update(){for(let t in this.colliding){let e=this.colliding[t];this.checkCollision(e.target)||(delete this.colliding[t],this.trigger("collideEnd",e.target,e))}},drawInspect(){let t=this.localArea();Ee(),me(this.area.scale),ge(this.area.offset);let e={outline:{width:4/Ne(),color:V(0,0,255)},anchor:this.anchor,fill:!1,fixed:this.fixed};t instanceof Q?Be({...e,pos:t.pos,width:t.width,height:t.height}):t instanceof q?Pe({...e,pts:t.pts}):t instanceof Y&&Me({...e,pos:t.center,radius:t.radius}),xe()},destroy(){e.forEach((t=>t()))},area:{shape:null!==(i=t.shape)&&void 0!==i?i:null,scale:null!==(n=t.scale)&&void 0!==n?n:A(1),offset:null!==(o=t.offset)&&void 0!==o?o:A(0),cursor:null!==(s=t.cursor)&&void 0!==s?s:null},isClicked(){return nr()&&this.isHovering()},isHovering(){let t=this.fixed?rr():Br(rr());return this.hasPoint(t)},checkCollision(t){if(this===t||!t.area||!t.exists())return null;return H(this.worldArea(),t.worldArea())},isColliding(t){let e=this.checkCollision(t);return e&&!e.isZero()},isTouching(t){return Boolean(this.checkCollision(t))},onClick(t){return this.onUpdate((()=>{this.isClicked()&&t()}))},onHover(t){let e=!1;return this.onUpdate((()=>{e?e=this.isHovering():this.isHovering()&&(e=!0,t())}))},onHoverUpdate(t){return this.onUpdate((()=>{this.isHovering()&&t()}))},onHoverEnd(t){let e=!1;return this.onUpdate((()=>{e?this.isHovering()||(e=!1,t()):e=this.isHovering()}))},onCollide(t,e){return"function"==typeof t&&void 0===e?this.on("collide",t):"string"==typeof t?this.onCollide(((r,i)=>{r.is(t)&&e(r,i)})):void 0},onCollideUpdate(t,e){return"function"==typeof t&&void 0===e?this.on("collideUpdate",t):"string"==typeof t?this.on("collideUpdate",((r,i)=>r.is(t)&&e(r,i))):void 0},onCollideEnd(t,e){return"function"==typeof t&&void 0===e?this.on("collideEnd",t):"string"==typeof t?this.on("collideEnd",(r=>r.is(t)&&e(r))):void 0},hasPoint(t){return N(this.worldArea(),O.fromVec2(t))},pushOut(t){let e=this.checkCollision(t);e&&(this.pos=this.pos.add(e))},pushOutAll(){It.root.getAll().forEach(this.pushOut)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let t=this.localArea();if(!(t instanceof q||t instanceof Q))throw new Error("Only support polygon and rect shapes for now");var e;let r=this.transform.scale(A(null!==(e=this.area.scale)&&void 0!==e?e:1)).translate(this.area.offset);if(t instanceof Q){let e=t.bbox(),i=bt(this.anchor||"topleft").add(1,1).scale(-.5).scale(e.width,e.height);r=r.translate(i)}return t.transform(r)},screenArea(){let t=this.worldArea();return this.fixed?t:t.transform(It.cam.transform)}}}function yi(t){return{color:t.color,opacity:t.opacity,anchor:t.anchor,outline:t.outline,fixed:t.fixed,shader:t.shader,uniform:t.uniform}}function Ei(t,e={}){let i=null,n=null;if(!t)throw new Error("Please pass the resource name or data to sprite()");let o=r(((t,e,r,i)=>{let n=A(1,1);return r&&i?(n.x=r/(t.width*e.w),n.y=i/(t.height*e.h)):r?(n.x=r/(t.width*e.w),n.y=n.x):i&&(n.y=i/(t.height*e.h),n.x=n.y),n}),"calcTexScale");var s;return{id:"sprite",width:0,height:0,frame:e.frame||0,quad:e.quad||new v(0,0,1,1),animSpeed:null!==(s=e.animSpeed)&&void 0!==s?s:1,draw(){!i||Re({...yi(this),sprite:i,frame:this.frame,quad:this.quad,flipX:e.flipX,flipY:e.flipY,tiled:e.tiled,width:e.width,height:e.height})},update(){if(!i){let r=ee(t);if(!r||!r.data)return;let n=r.data.frames[0].clone();e.quad&&(n=n.scale(e.quad));let s=o(r.data.tex,n,e.width,e.height);this.width=r.data.tex.width*n.w*s.x,this.height=r.data.tex.height*n.h*s.y,e.anim&&this.play(e.anim),i=r.data,this.trigger("spriteLoaded",i)}if(!n)return;let r=i.anims[n.name];if("number"!=typeof r){if(0===r.speed)throw new Error("Sprite anim speed cannot be 0");n.timer+=Er()*this.animSpeed,n.timer>=1/n.speed&&(n.timer=0,r.from>r.to?(this.frame--,this.frame<r.to&&(n.loop?this.frame=r.from:(this.frame++,n.onEnd(),this.stop()))):(this.frame++,this.frame>r.to&&(n.loop?this.frame=r.from:(this.frame--,n.onEnd(),this.stop()))))}else this.frame=r},play(t,e={}){if(!i)return void this.on("spriteLoaded",(()=>{this.play(t,e)}));let r=i.anims[t];if(!r)throw new Error(`Anim not found: ${t}`);var o,s,a,l,u,h,d;n&&this.stop(),n="number"==typeof r?{name:t,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:t,timer:0,loop:null!==(s=null!==(o=e.loop)&&void 0!==o?o:r.loop)&&void 0!==s&&s,pingpong:null!==(l=null!==(a=e.pingpong)&&void 0!==a?a:r.pingpong)&&void 0!==l&&l,speed:null!==(h=null!==(u=e.speed)&&void 0!==u?u:r.speed)&&void 0!==h?h:10,onEnd:null!==(d=e.onEnd)&&void 0!==d?d:()=>{}},this.frame="number"==typeof r?r:r.from,this.trigger("animStart",t)},stop(){if(!n)return;let t=n.name;n=null,this.trigger("animEnd",t)},numFrames:()=>i?i.frames.length:0,curAnim:()=>null==n?void 0:n.name,flipX(t){e.flipX=t},flipY(t){e.flipY=t},onAnimEnd(t,e){return this.on("animEnd",(r=>{r===t&&e()}))},onAnimStart(t,e){return this.on("animStart",(r=>{r===t&&e()}))},renderArea(){return new Q(A(0),this.width,this.height)},inspect(){if("string"==typeof t)return`"${t}"`}}}function xi(t,e={}){function i(t){var r,i;let n=Oe({...yi(t),text:t.text+"",size:t.textSize,font:t.font,width:e.width&&t.width,align:t.align,letterSpacing:t.letterSpacing,lineSpacing:t.lineSpacing,transform:t.textTransform,styles:t.textStyles});return e.width||(t.width=n.width/((null===(r=t.scale)||void 0===r?void 0:r.x)||1)),t.height=n.height/((null===(i=t.scale)||void 0===i?void 0:i.y)||1),n}var n;return r(i,"update"),{id:"text",text:t,textSize:null!==(n=e.size)&&void 0!==n?n:16,font:e.font,width:e.width,height:0,align:e.align,lineSpacing:e.lineSpacing,letterSpacing:e.letterSpacing,textTransform:e.transform,textStyles:e.styles,add(){Li((()=>i(this)))},draw(){Je(i(this))},renderArea(){return new Q(A(0),this.width,this.height)}}}function Si(t,e,r={}){return{id:"rect",width:t,height:e,radius:r.radius||0,draw(){Be({...yi(this),width:this.width,height:this.height,radius:this.radius})},renderArea(){return new Q(A(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function bi(t,e){return{id:"rect",width:t,height:e,draw(){Se({...yi(this),width:this.width,height:this.height})},renderArea(){return new Q(A(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function Ri(t){return{id:"circle",radius:t,draw(){Me({...yi(this),radius:this.radius})},renderArea(){return new Y(A(0),this.radius)},inspect(){return`${Math.ceil(this.radius)}`}}}function Ti(t=1,e=V(0,0,0)){return{id:"outline",outline:{width:t,color:e}}}function Bi(t,e){let r=new J;return t&&e&&r.pushd(new ot(t,e)),{id:"timer",wait:(t,e)=>r.pushd(new ot(t,e)),update(){r.forEach(((t,e)=>{t.tick(Er())&&r.delete(e)}))}}}r(Er,"dt"),r(xr,"camPos"),r(Sr,"camScale"),r(br,"camRot"),r(Rr,"shake"),r(Tr,"toScreen"),r(Br,"toWorld"),r(Ur,"calcTransform"),r(Ir,"make"),r(Fr,"on"),r(Mr,"onUpdate"),r(Cr,"onDraw"),r(Pr,"onAdd"),r(kr,"onDestroy"),r(Dr,"onCollide"),r(Lr,"forAllCurrentAndFuture"),r(Nr,"onClick"),r(Gr,"onHover"),r(Qr,"onHoverUpdate"),r(Yr,"onHoverEnd"),r(Kr,"wait"),r(qr,"loop"),r(Or,"onKeyDown"),r(Hr,"onKeyPress"),r(Jr,"onKeyPressRepeat"),r(zr,"onKeyRelease"),r(jr,"onMouseDown"),r(Wr,"onMousePress"),r(Xr,"onMouseRelease"),r(Zr,"onMouseMove"),r(_r,"onCharInput"),r($r,"onTouchStart"),r(ti,"onTouchMove"),r(ei,"onTouchEnd"),r(ri,"onVirtualButtonPress"),r(ii,"onVirtualButtonDown"),r(ni,"onVirtualButtonRelease"),r(oi,"enterDebugMode"),r(si,"enterBurpMode"),r(ai,"gravity"),r(li,"pos"),r(ui,"scale"),r(hi,"rotate"),r(di,"color"),r(ci,"toFixed"),r(Ai,"opacity"),r(fi,"anchor"),r(pi,"z"),r(gi,"follow"),r(mi,"move"),r(Vi,"outview"),r(wi,"cleanup"),r(vi,"area"),r(yi,"getRenderProps"),r(Ei,"sprite"),r(xi,"text"),r(Si,"rect"),r(bi,"uvquad"),r(Ri,"circle"),r(Ti,"outline"),r(Bi,"timer");function Ui(t={}){let e=0,r=null,i=null,n=!1,o=[];var s,a,l,u;return{id:"body",require:["pos","area"],jumpForce:null!==(s=t.jumpForce)&&void 0!==s?s:640,gravityScale:null!==(a=t.gravityScale)&&void 0!==a?a:1,isStatic:null!==(l=t.isStatic)&&void 0!==l&&l,mass:null!==(u=t.mass)&&void 0!==u?u:0,add(){o.push(this.onCollideUpdate(((t,e)=>{if(!t.is("body")||e.resolved||this.isStatic&&t.isStatic)return;e.resolved=!0;let r=!this.isStatic&&t.isStatic?e:e.reverse();r.source.pos=r.source.pos.add(r.displacement),r.source.transform=Ur(r.source),r.source.trigger("physicsResolve",r),r.target.trigger("physicsResolve",r.reverse())}))),o.push(this.onPhysicsResolve((t=>{It.gravity&&(t.isBottom()&&this.isFalling()?(e=0,r=t.target,i=t.target.pos,n?n=!1:this.trigger("ground",r)):t.isTop()&&this.isRising()&&(e=0,this.trigger("headbutt",t.target)))})))},update(){if(!It.gravity||this.isStatic)return;if(n&&(r=null,i=null,this.trigger("fallOff"),n=!1),r){if(this.isTouching(r)&&r.exists()&&r.is("body"))return r.pos.eq(i)||this.moveBy(r.pos.sub(i)),void(i=r.pos);n=!0}let o=e;var s;e+=It.gravity*this.gravityScale*Er(),e=Math.min(e,null!==(s=t.maxVelocity)&&void 0!==s?s:65536),o<0&&e>=0&&this.trigger("fall"),this.move(0,e)},destroy(){o.forEach((t=>t()))},onPhysicsResolve(t){return this.on("physicsResolve",t)},curPlatform:()=>r,isGrounded:()=>null!==r,isFalling:()=>e>0,isRising:()=>e<0,jump(t){r=null,i=null,e=-t||-this.jumpForce},onGround(t){return this.on("ground",t)},onFall(t){return this.on("fall",t)},onFallOff(t){return this.on("fallOff",t)},onHeadbutt(t){return this.on("headbutt",t)}}}function Ii(){let t=!0,e=[];return{require:["body"],add(){e.push(this.onGround((()=>{t=!0})))},destroy(){e.forEach((t=>t()))},doubleJump(e){this.isGrounded()?this.jump(e):t&&(t=!1,this.jump(e),this.trigger("doubleJump"))},onDoubleJump(t){return this.on("doubleJump",t)}}}function Fi(t,e={}){return{id:"shader",shader:t,uniform:e}}function Mi(){return{id:"fixed",fixed:!0}}function Ci(){return{id:"stay",stay:!0}}function Pi(t){if(null==t)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(e=1){this.setHP(t-e),this.trigger("hurt")},heal(e=1){this.setHP(t+e),this.trigger("heal")},hp:()=>t,setHP(e){(t=e)<=0&&this.trigger("death")},onHurt(t){return this.on("hurt",t)},onHeal(t){return this.on("heal",t)},onDeath(t){return this.on("death",t)},inspect:()=>`${t}`}}function ki(t,e={}){if(null==t)throw new Error("lifespan() requires time");var r;let i=0,n=null!==(r=e.fade)&&void 0!==r?r:0,o=Math.max(t-n,0);return{id:"lifespan",update(){i+=Er(),i>=o&&(this.opacity=u(i,o,t,1,0)),i>=t&&this.destroy()}}}function Di(t,e,i){if(!t)throw new Error("state() requires an initial state");let n={};function o(t){n[t]||(n[t]={enter:new z,end:new z,update:new z,draw:new z})}function s(t,e,r){return o(e),n[e][t].add(r)}function a(t,e,...r){o(e),n[e][t].trigger(...r)}r(o,"initStateEvents"),r(s,"on"),r(a,"trigger");let l=!1;return{id:"state",state:t,enterState(t,...r){if(l=!0,e&&!e.includes(t))throw new Error(`State not found: ${t}`);let n=this.state;if(i){if(!(null==i?void 0:i[n]))return;let e="string"==typeof i[n]?[i[n]]:i[n];if(!e.includes(t))throw new Error(`Cannot transition state from "${n}" to "${t}". Available transitions: ${e.map((t=>`"${t}"`)).join(", ")}`)}a("end",n,...r),this.state=t,a("enter",t,...r),a("enter",`${n} -> ${t}`,...r)},onStateTransition:(t,e,r)=>s("enter",`${t} -> ${e}`,r),onStateEnter:(t,e)=>s("enter",t,e),onStateUpdate:(t,e)=>s("update",t,e),onStateDraw:(t,e)=>s("draw",t,e),onStateEnd:(t,e)=>s("end",t,e),update(){l||(a("enter",t),l=!0),a("update",this.state)},draw(){a("draw",this.state)},inspect(){return this.state}}}function Li(t){Ut.loaded?t():It.ev.on("load",t)}function Ni(t,e){It.scenes[t]=e}function Gi(t,...r){if(!It.scenes[t])throw new Error(`Scene not found: ${t}`);It.ev.onOnce("frameEnd",(()=>{It.ev=new j,It.objEvents=new j,It.root.get().forEach((t=>{t.stay||It.root.remove(t)})),It.root.clearEvents(),It.timers=new J,It.cam={pos:null,scale:A(1),angle:0,shake:0,transform:new E},It.gravity=0,It.scenes[t](...r),!1!==e.debug&&oi(),e.burp&&si()}))}function Qi(t,e){try{return JSON.parse(window.localStorage[t])}catch{return e?(Yi(t,e),e):null}}function Yi(t,e){window.localStorage[t]=JSON.stringify(e)}function Ki(t){let r=t(wn);for(let t in r)wn[t]=r[t],!1!==e.global&&(window[t]=r[t]);return wn}function qi(){return A(je()/2,We()/2)}function Oi(t,e){return{id:"grid",gridPos:e.clone(),setGridPos(...e){let r=A(...e);this.gridPos=r.clone(),this.pos=A(this.gridPos.x*t.gridWidth(),this.gridPos.y*t.gridHeight())},moveLeft(){this.setGridPos(this.gridPos.add(A(-1,0)))},moveRight(){this.setGridPos(this.gridPos.add(A(1,0)))},moveUp(){this.setGridPos(this.gridPos.add(A(0,-1)))},moveDown(){this.setGridPos(this.gridPos.add(A(0,1)))}}}function Hi(t,e){if(!e.width||!e.height)throw new Error("Must provide level grid width & height.");var r;let i=Wi([li(null!==(r=e.pos)&&void 0!==r?r:A(0))]),n=0,o={id:"level",gridWidth:()=>e.width,gridHeight:()=>e.height,getPos(...t){let r=A(...t);return A(r.x*e.width,r.y*e.height)},spawn(t,...r){let n=A(...r),o=(()=>{if(e[t]){if("function"!=typeof e[t])throw new Error("Level symbol def must be a function returning a component list");return e[t](n)}if(e.any)return e.any(t,n)})();if(!o)return;let s=A(n.x*e.width,n.y*e.height);for(let t of o)if("pos"===t.id){s.x+=t.pos.x,s.y+=t.pos.y;break}return o.push(li(s)),o.push(Oi(this,n)),i.add(o)},levelWidth:()=>n*e.width,levelHeight:()=>t.length*e.height};return i.use(o),t.forEach(((t,e)=>{let r=t.split("");n=Math.max(r.length,n),r.forEach(((t,r)=>{i.spawn(t,A(r,e))}))})),i}function Ji(t){let e=n.canvas.captureStream(t),r=X.ctx.createMediaStreamDestination();X.masterNode.connect(r);let i=new MediaRecorder(e),o=[];return i.ondataavailable=t=>{t.data.size>0&&o.push(t.data)},i.onerror=()=>{X.masterNode.disconnect(r),e.getTracks().forEach((t=>t.stop()))},i.start(),{resume(){i.resume()},pause(){i.pause()},stop:()=>(i.stop(),X.masterNode.disconnect(r),e.getTracks().forEach((t=>t.stop())),new Promise((t=>{i.onstop=()=>{t(new Blob(o,{type:"video/mp4"}))}}))),download(t="kaboom.mp4"){this.stop().then((e=>et(t,e)))}}}function zi(){return document.activeElement===n.canvas}function ji(t){t.destroy()}r(Ui,"body"),r(Ii,"doubleJump"),r(Fi,"shader"),r(Mi,"fixed"),r(Ci,"stay"),r(Pi,"health"),r(ki,"lifespan"),r(Di,"state"),r(Li,"onLoad"),r(Ni,"scene"),r(Gi,"go"),r(Qi,"getData"),r(Yi,"setData"),r(Ki,"plug"),r(qi,"center"),r(Oi,"grid"),r(Hi,"addLevel"),r(Ji,"record"),r(zi,"isFocused"),r(ji,"destroy");let Wi=It.root.add.bind(It.root),Xi=It.root.readd.bind(It.root),Zi=It.root.removeAll.bind(It.root),_i=It.root.get.bind(It.root),$i=It.root.getAll.bind(It.root);function tn(t=2,e=1){let r=0;return{id:"explode",require:["scale"],update(){let i=Math.sin(r*t)*e;i<0&&this.destroy(),this.scale=A(i),r+=Er()}}}r(tn,"explode");let en=qt(null,"data:image/png;base64,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"),rn=qt(null,"data:image/png;base64,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");function nn(t,e={}){let r=Wi([li(t),{id:"stay",stay:!0}]),i=5*(e.speed||1),n=e.scale||1;var o,s;r.add([Ei(rn),ui(0),fi("center"),tn(i,n),...(null!==(o=e.boomComps)&&void 0!==o?o:()=>[])()]);let a=r.add([Ei(en),ui(0),fi("center"),Bi(.4/i,(()=>a.use(tn(i,n)))),...(null!==(s=e.kaComps)&&void 0!==s?s:()=>[])()]);return a.onDestroy((()=>r.destroy())),r}function on(){It.timers.forEach(((t,e)=>{t.time-=Er(),t.time<=0&&(t.action(),It.timers.delete(e))})),It.root.update()}r(nn,"addKaboom"),r(on,"updateFrame");class sn{reverse(){return new sn(this.target,this.source,this.displacement.scale(-1),this.resolved)}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}constructor(e,r,i,n=!1){t(this,"source",void 0),t(this,"target",void 0),t(this,"displacement",void 0),t(this,"resolved",!1),this.source=e,this.target=r,this.displacement=i,this.resolved=n}}function an(){let t={},i=e.hashGridSize||64,n=new E,o=[];function s(e){if(o.push(n),e.pos&&(n=n.translate(e.pos)),e.scale&&(n=n.scale(e.scale)),e.angle&&(n=n.rotateZ(e.angle)),e.transform=n.clone(),e.c("area")&&!e.paused){let r=e,n=r.worldArea().bbox(),o=Math.floor(n.pos.x/i),s=Math.floor(n.pos.y/i),a=Math.ceil((n.pos.x+n.width)/i),l=Math.ceil((n.pos.y+n.height)/i),u=new Set;for(let e=o;e<=a;e++)for(let i=s;i<=l;i++)if(t[e])if(t[e][i]){let n=t[e][i];for(let t of n){if(!t.exists()||u.has(t.id))continue;for(let e of r.collisionIgnore)t.is(e);for(let e of t.collisionIgnore)r.is(e);let e=r.checkCollision(t);if(e&&!e.isZero()){let i=new sn(r,t,e);r.trigger("collideUpdate",t,i);let n=i.reverse();n.resolved=i.resolved,t.trigger("collideUpdate",r,n)}u.add(t.id)}n.push(r)}else t[e][i]=[r];else t[e]={},t[e][i]=[r]}e.get().forEach(s),n=o.pop()}r(s,"checkObj"),s(It.root)}function ln(){let t=It.cam,e=c.fromAngle(T(0,360)).scale(t.shake);var r;t.shake=l(t.shake,0,5*Er()),t.transform=(new E).translate(qi()).scale(t.scale).rotateZ(t.angle).translate((null!==(r=t.pos)&&void 0!==r?r:qi()).scale(-1).add(e)),It.root.draw(),de()}function un(){let t=Mt();Ge((()=>{let e=je()/2,r=A(je()/2,We()/2).sub(A(e/2,12));Be({pos:A(0),width:je(),height:We(),color:V(0,0,0)}),Be({pos:r,width:e,height:24,fill:!1,outline:{width:4}}),Be({pos:r,width:e*t,height:24})})),It.ev.trigger("loading",t)}function hn(t,e){Ge((()=>{let r=A(8);Ee(),ge(t);let i=Oe({text:e,font:"sink",size:16,pos:r,color:V(255,255,255),fixed:!0}),n=i.width+2*r.x,o=i.height+2*r.x;t.x+n>=je()&&ge(A(-n,0)),t.y+o>=We()&&ge(A(0,-o)),Be({width:n,height:o,color:V(0,0,0),radius:4,opacity:.8,fixed:!0}),Je(i),xe()}))}function dn(){if(yr.inspect){let t=null;for(let e of $i())if(e.c("area")&&e.isHovering()){t=e;break}if(It.root.drawInspect(),t){let e=[],r=t.inspect();for(let t in r)r[t]?e.push(`${t}: ${r[t]}`):e.push(`${t}`);hn(tr(rr()),e.join("\n"))}hn(A(8),`FPS: ${yr.fps()}`)}yr.paused&&Ge((()=>{Ee(),ge(je(),0),ge(-8,8);Be({width:32,height:32,anchor:"topright",color:V(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=1;t<=2;t++)Be({width:4,height:19.2,anchor:"center",pos:A(-32/3*t,16),color:V(255,255,255),radius:2,fixed:!0});xe()})),1!==yr.timeScale&&Ge((()=>{Ee(),ge(je(),We()),ge(-8,-8);let t=Oe({text:yr.timeScale.toFixed(1),font:"sink",size:16,color:V(255,255,255),pos:A(-8),anchor:"botright",fixed:!0});Be({width:t.width+16+32,height:t.height+16,anchor:"botright",color:V(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=0;e<2;e++){let r=yr.timeScale<1;Fe({p1:A(-t.width-8*(r?2:3.5),-8),p2:A(-t.width-8*(r?2:3.5),-8-t.height),p3:A(-t.width-8*(r?3.5:2),-8-t.height/2),pos:A(8*-e*1+(r?-4:0),0),color:V(255,255,255),fixed:!0})}Je(t),xe()})),yr.curRecording&&Ge((()=>{Ee(),ge(0,We()),ge(24,-24),Me({radius:12,color:V(255,0,0),opacity:x(0,1,4*gr()),fixed:!0}),xe()})),yr.showLog&&It.logs.length>0&&Ge((()=>{Ee(),ge(0,We()),ge(8,-8);let t=Oe({text:It.logs.join("\n"),font:"sink",pos:A(8,-8),anchor:"botleft",size:16,width:.6*je(),lineSpacing:4,fixed:!0,styles:{time:{color:V(127,127,127)},info:{color:V(255,255,255)},error:{color:V(255,0,127)}}});Be({width:t.width+16,height:t.height+16,anchor:"botleft",color:V(0,0,0),radius:4,opacity:.8,fixed:!0}),Je(t),xe()}))}function cn(){let t=rr(),e=r(((e,r,i)=>{Me({radius:32,pos:e,outline:{width:4,color:V(0,0,0)}}),i&&He({text:i,pos:e,color:V(0,0,0),size:40,anchor:"center"}),nr("left")&&L(new Y(e,32),O.fromVec2(t))&&(n.virtualButtonStates[r]="pressed"),sr("left")&&(n.virtualButtonStates[r]="released")}),"drawCircleButton"),i=r(((e,r,i)=>{Be({width:48,height:48,pos:e,outline:{width:4,color:V(0,0,0)},radius:4,anchor:"center"}),i&&He({text:i,pos:e,color:V(0,0,0),size:40,anchor:"center"}),nr("left")&&D(new Q(e.add(-24,-24),48,48),O.fromVec2(t))&&(n.virtualButtonStates[r]="pressed"),sr("left")&&(n.virtualButtonStates[r]="released")}),"drawSquareButton");for(let t in n.virtualButtonStates)n.virtualButtonStates[t]=yt(n.virtualButtonStates[t]);Ge((()=>{e(A(je()-64,We()-128),"a","A"),e(A(je()-128,We()-64),"b","B"),i(A(48,We()-112),"left"),i(A(144,We()-112),"right"),i(A(96,We()-160),"up"),i(A(96,We()-64),"down")}))}function An(t){It.ev.on("loading",t)}function fn(t){It.ev.on("resize",t)}function pn(t){It.ev.on("error",t)}function gn(t){mn((()=>{Ge((()=>{let e=je(),r={size:24,width:e-64,letterSpacing:4,lineSpacing:4,font:"sink",fixed:!0};Be({width:e,height:We(),color:V(0,0,255),fixed:!0});let i=Oe({...r,text:t.name,pos:A(32),color:V(255,128,0),fixed:!0});Je(i),He({...r,text:t.message,pos:A(32,32+i.height+16),fixed:!0}),xe(),It.ev.trigger("error",t)}))}))}function mn(t){null!==n.loopID&&cancelAnimationFrame(n.loopID);let e=r((r=>{if(n.stopped)return;if("visible"!==document.visibilityState)return void(n.loopID=requestAnimationFrame(e));let i=r/1e3,o=i-n.realTime;n.realTime=i,n.skipTime||(n.dt=o,n.time+=Er(),n.fpsCounter.tick(n.dt)),n.skipTime=!1,n.numFrames++,ce(),t(),Ae();for(let t in n.keyStates)n.keyStates[t]=yt(n.keyStates[t]);for(let t in n.mouseStates)n.mouseStates[t]=yt(n.mouseStates[t]);n.charInputted=[],n.isMouseMoved=!1,n.isKeyPressed=!1,n.isKeyPressedRepeat=!1,n.isKeyReleased=!1,n.loopID=requestAnimationFrame(e),It.ev.trigger("frameEnd")}),"frame");e(0)}function Vn(){It.ev.onOnce("frameEnd",(()=>{n.stopped=!0,d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT);let t=d.getParameter(d.MAX_TEXTURE_IMAGE_UNITS);for(let e=0;e<t;e++)d.activeTexture(d.TEXTURE0+e),d.bindTexture(d.TEXTURE_2D,null),d.bindTexture(d.TEXTURE_CUBE_MAP,null);d.bindBuffer(d.ARRAY_BUFFER,null),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null),d.bindRenderbuffer(d.RENDERBUFFER,null),d.bindFramebuffer(d.FRAMEBUFFER,null),i.forEach((t=>t())),d.deleteBuffer(b.vbuf),d.deleteBuffer(b.ibuf);for(let t in Xe)n.canvas.removeEventListener(t,Xe[t]);for(let t in Ze)document.removeEventListener(t,Ze[t]);for(let t in _e)window.removeEventListener(t,_e[t])}))}r(sn,"Collision"),r(an,"checkFrame"),r(ln,"drawFrame"),r(un,"drawLoadScreen"),r(hn,"drawInspectText"),r(dn,"drawDebug"),r(cn,"drawVirtualControls"),!1!==e.debug&&oi(),e.burp&&si(),r(An,"onLoadUpdate"),r(fn,"onResize"),r(pn,"onError"),r(gn,"handleErr"),r(mn,"run"),r(Vn,"quit"),Qt("sink","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAACAAQMAAADOEv75AAAAAXNSR0IArs4c6QAAAAZQTFRFAAAA////pdmf3QAAAAF0Uk5TAEDm2GYAAASQSURBVDjLVZVNTBtHFMffrk0YHLc21JVQuwrrdQOOFdVwa0NktlYl3FRVCRLnUvWSICJhuKStIoa1CYs5uAdOyELWlqTWumoFB4RItXJIJCMqxe2x4mIKjRGH2imHGkzsvlljKHPY3Z//M+9rnp7hBBrrKYXXWZd7w4THBlR1I5y1dzuM0iMKtaJx/PNiaFNTH6Jy3agUEfTfo6iMJMYUezfR0tMGGiDuLIDD2H6Dwrlpu/n8urDIXg4VaAd90XtPpCbk7y+ubt8bU0g4l4Cj1yurN3fKkfZYlwC145WH2w88RSP2gwBHZWO19yv3M1QCkJ/8pVariXhmIwDU2TDNBwCi82KnvSeGtnkG33xilfsJgBXBSIaI/LlqAnWNRUHuD1jyKNLANRuVb6HiRCuuVy0gy6SbAXVJnbSHgpMXz7IB9hmeCVwuBMIZIFYBVFVpI1JMxG0SqDTqyfExiXh2eEhN2UPe6LgIMkRBVXjVG53Ng8gRUKPSsVdVpfa3/gSYKCZasiScIcRKztywWGAsLhwWE3O7muJNwGxIixFJpVpkVIN1bzJGRJUuKT8i+MW53Ptluqb4NIjsJ9k2dUm5poHiNc+oGoNxv3C4L8wV0HUCLqxXOeHYq8f8axEFIObVJAQxKU8zSCIMukVZpfCPX5Cu+txBkV2e4lUQBqKik0FIkySfqpowlUq4N1xqfO0yDVz0002AWCilyTwrJIIVKIisoq2/CndzC8uRx55PBYDr2sJ7nZt0TcLkuP3k3B6mvSSlNOBHtQXrFawBAy4t3H3Oz+1r7zTyEaD5gj/BQ93sLZsVFadbYTl9xcz0OzHWBlujyaCZHMg2zFQIXvVJklOkdti6wyPc3kNwwXLq5oeYjz/hoW1AzVbgMvhwQ8vQCDYa+4WWAGz6pTpMlSH4aKSlDpETpjiVvnzVEvm3imdkMUhExSrPVFGhsoRAxHgNz8i0rQGoAN8ADnwAJjhqwCv6JThTmnwOMK3VlY547qRqoWh6qMnXlzH7qbkKuqJP5k3AcFCplUzgyqDTBmAKb3+ROS+eLfm/Sp4qjsy5YqllefxwOQ46cBDUMiIMAwFfB+0zoWQq8dopMKUO6HRoADqmSrsYHosgaUKWsAhOlU2Vy5QaSk7dzQ+DfHsA3uze3aKWYYCkmGKwSVkEp0qOsls5VTLAyXUFr4MNB8lUcNA5jMoBZcq7EbqT02JdhCmpj+lhwTXom2cR/Kaplb+EiQJhEXyJHb+vl3GmoLLiveHMGWVFYgrrt8ZKEb5eE7w5bsBmAci4BvHejiAV7BK4lzd0hLGpAbnLsBTXY0zZ4nFUnkJlrwniRmsuwc5UDninEvhghkgI4edNTl64r2CfcWcTSOAdT9FZO5fxi83COPkIRl78NJGH8gxh8OT7dj3Zi9NRR6i8tFd2YKyujOSMcL//j1vzEgK6h0tUbZIGGTQL4HgCTTDITGPBzDtmTnsiQrogcM/sDL7NGse6PrG3GGQpFH1p/GtITa4jlP8OhD/T0vsPWKaVoqHatKPQJNsWzvrQ+mxo8jyF7TuTWKr/ABVF/mebwsnnAAAAAElFTkSuQmCC",6,8,{chars:" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"}),Qt("sinko","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAAA8AgMAAADTWFpWAAAAAXNSR0IArs4c6QAAAAlQTFRFAAAAAAAA////g93P0gAAAAF0Uk5TAEDm2GYAAANeSURBVDjLjVVLruQoEMQLfAMsuU7DEVgklux1YulxGi84AgftiAS/eeqZUTcl47IJ8hMZpJ1zPgYJyUcnIfrkU4hZ3Dv4b4277s8mWa+0PtvzSbcCbmPRCTjb1Usrj3/2FJ6rrS+gTUDtt+SnpDXtbnlqP2CajvxjgCCw0LZ0io8EXK1253htyQB8OHSPNzwScOshPtHCTlcM6Gy1nVLgkTFkWeP6cOV008L+HKnoBQvMgkv0vsbipgXyIBIYFniwbQb7h5B/jZcJ7A0xMCDJwjue08thwKq72icyrQVcXGDgQsIvhztWXNEtFs3qW5GCQPlDiNG3LBueneoaubxJRaoZy3yzxi3VDtAA+La2U7m4wMGwsKOmCzYaYEtcFOz1D9joEADfCTYmxHAIOESI9L7Ca8CWD6zWvlElzICxQw2NZUZWzcctLpplRyyOuTN7ZwzAuPGAIhkP33T9PsKPv9iVsStPS4LZC4bjZEwiY3ivMxZFuGtHQo5BG5NnG/yBSSFNEAvpcl/9C3d3W3okAUQnQhC5loYV/aIhAmojo/Wpzw03axStiS5u8ySk6NsCyYpqFjB3AmYFGQN3MYb5BABiuB4Yn1ngybIYs44sLPPJg4ynycbk4Y9j7GZFON45Q885WiWGf9YU8Vli9F9xImq0g/fmcMgAMA/IB2fqiGczgFpSlj0AJN6DBWqhqLkYaRJwtltxxlE+xbkGozxYg6hs/O0PLQASFZ1hNhGw19QIxglJ9/gnJS7tiNZEwB6iGGpcERZVzixw0qxvQHrBGKMaeQm6DHlwvFyWPzPp02iGnLzwxo5JHieArUZHtG7rvFFR6uo3AHUouIIGdLmAE45+C3Ue0DprhHw/7QZRl7Iel97oF2svEN6XvXcL9lK9VA/OKJS8Ra8V1N/2Hk4u0ySP7+6GJqlqAlgnkt2nBdkBpiaFMLmtjLSgM4Znd8HUwJ3eZutXwTTJb0Zwn0Y9XZiX/9bkePEXUrUzH/+vI2B8oIYazRL8Mwb0qZ+q3qEnaJKfE2TALPqr6mJ5nKjImm5aAAfkARZe0ULVrdgHwaIYB/Vqu3tFS+kNCxYOLajLuoPsIdqrnzMGAzAGVL9t3T5rjY209pGFAVB/hX6Sl1eTn5blBw8yFfc7m+/4BR+d4KDrSif0AAAAAElFTkSuQmCC",8,10),mn((()=>{Ut.loaded||1===Mt()&&(Ut.loaded=!0,It.ev.trigger("load")),Ut.loaded||!1===e.loadingScreen?(It.ev.trigger("input"),yr.paused||on(),an(),ln(),!1!==e.debug&&dn(),e.virtualControls&&cn()):un()}));let wn={VERSION:"3000.0.0-alpha.0",loadRoot:Ct,loadProgress:Mt,loadSprite:qt,loadSpriteAtlas:Kt,loadSound:zt,loadBitmapFont:Qt,loadFont:Gt,loadShader:Jt,loadAseprite:Ht,loadPedit:Ot,loadBean:jt,loadMark:Wt,load:Ft,getSprite:Xt,getSound:Zt,getFont:_t,getBitmapFont:$t,getShader:te,Asset:dt,SpriteData:C,SoundData:K,width:je,height:We,center:qi,dt:Er,time:gr,screenshot:mr,record:Ji,isFocused:zi,setCursor:Vr,setFullscreen:wr,isFullscreen:vr,isTouch:()=>n.isTouch,onLoad:Li,onLoadUpdate:An,onResize:fn,onError:pn,camPos:xr,camScale:Sr,camRot:br,shake:Rr,toScreen:Tr,toWorld:Br,gravity:ai,add:Wi,make:Ir,destroy:ji,destroyAll:Zi,get:_i,getAll:$i,readd:Xi,pos:li,scale:ui,rotate:hi,color:di,opacity:Ai,anchor:fi,area:vi,sprite:Ei,text:xi,rect:Si,circle:Ri,uvquad:bi,outline:Ti,body:Ui,doubleJump:Ii,shader:Fi,timer:Bi,fixed:Mi,stay:Ci,health:Pi,lifespan:ki,z:pi,move:mi,outview:Vi,cleanup:wi,follow:gi,state:Di,on:Fr,onUpdate:Mr,onDraw:Cr,onAdd:Pr,onDestroy:kr,onCollide:Dr,onClick:Nr,onHover:Gr,onHoverUpdate:Qr,onHoverEnd:Yr,onKeyDown:Or,onKeyPress:Hr,onKeyPressRepeat:Jr,onKeyRelease:zr,onMouseDown:jr,onMousePress:Wr,onMouseRelease:Xr,onMouseMove:Zr,onCharInput:_r,onTouchStart:$r,onTouchMove:ti,onTouchEnd:ei,onVirtualButtonPress:ri,onVirtualButtonDown:ii,onVirtualButtonRelease:ni,mousePos:rr,mouseDeltaPos:ir,isKeyDown:hr,isKeyPressed:lr,isKeyPressedRepeat:ur,isKeyReleased:dr,isMouseDown:or,isMousePressed:nr,isMouseReleased:sr,isMouseMoved:ar,isVirtualButtonPressed:cr,isVirtualButtonDown:Ar,isVirtualButtonReleased:fr,loop:qr,wait:Kr,play:se,volume:oe,burp:ae,audioCtx:X.ctx,Timer:ot,Line:G,Rect:Q,Circle:Y,Polygon:q,Point:O,Vec2:c,Color:m,Mat4:E,Quad:v,RNG:S,rand:T,randi:B,randSeed:R,vec2:A,rgb:V,hsl2rgb:w,quad:y,choose:I,chance:U,lerp:l,map:u,mapc:h,wave:x,deg2rad:o,rad2deg:s,testLineLine:P,testRectRect:M,testRectLine:k,testRectPoint:D,drawSprite:Re,drawText:He,formatText:Oe,drawRect:Be,drawLine:Ue,drawLines:Ie,drawTriangle:Fe,drawCircle:Me,drawEllipse:Ce,drawUVQuad:Se,drawPolygon:Pe,drawFormattedText:Je,drawMasked:De,drawSubtracted:Le,pushTransform:Ee,popTransform:xe,pushTranslate:ge,pushScale:me,pushRotate:ye,pushRotateX:Ve,pushRotateY:we,pushRotateZ:ve,pushMatrix:pe,debug:yr,scene:Ni,go:Gi,addLevel:Hi,getData:Qi,setData:Yi,download:_,downloadJSON:tt,downloadText:$,downloadBlob:et,plug:Ki,ASCII_CHARS:ht,CP437_CHARS:"  !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",canvas:n.canvas,addKaboom:nn,LEFT:c.LEFT,RIGHT:c.RIGHT,UP:c.UP,DOWN:c.DOWN,RED:m.RED,GREEN:m.GREEN,BLUE:m.BLUE,YELLOW:m.YELLOW,MAGENTA:m.MAGENTA,CYAN:m.CYAN,WHITE:m.WHITE,BLACK:m.BLACK,quit:Vn};if(e.plugins&&e.plugins.forEach(Ki),!1!==e.global)for(let t in wn)window[t]=wn[t];return wn}),"default")({loadingScreen:!1,background:[30,30,40]}),scene("main",(()=>{const t=width()/4;add([pos(center()),anchor("center"),rect(width(),height()),color(30,30,40)]).onDraw((()=>{drawCircle({pos:vec2(0,0),radius:t,color:rgb(51,46,65)}),drawCircle({pos:vec2(0,0),radius:t/2,color:rgb(30,30,40)})}));const e=(t+t/2)/2,r=.25*(t-t/2),i=[],n=add([pos(Bt(-90,e)),area({shape:new Rect(vec2(-r,-r),2*r,2*r)}),circle(r),color(177,227,173),{speed:180,_angle:-90,update(){this._angle+=this.speed*dt(),this.pos=Bt(this._angle,e)}}]);function o(){return{spinSpeed:120,update(){this.angle+=this.spinSpeed*dt()}}}function s(){const e=center().x-t,r=center().x+t;return{maxAngle:choose([90,180,270]),startPos:rand(e,r),spinSpeed:120,update(){this.pos.x>this.startPos&&this.angle<this.maxAngle&&(this.angle+=this.spinSpeed*dt())}}}loop(.08,(()=>{i.push(n.pos),i.length>6&&i.shift()})),onDraw((()=>{let t=.5,e=r/4;i.forEach(((r,i)=>{t+=.03,drawCircle({pos:r,radius:e/6*(i+1),color:rgb(177,227,173),opacity:t})}))}));const a=width()/120;loop(a,(()=>{let e=0,i=0,n=2*r,a=2.15*n;const l=center().y-t,u=center().y+t;for(let t=0;t<2;t+=1)i=rand(l,u),chance(.5)&&([a,n]=[n,a]),add([rect(n,a,{radius:50}),pos(e,i),anchor("center"),color(227,140,143),move(RIGHT,120),area(),rotate(0),choose([o(),{update(){this.angle=wave(-15,15,6*window.time())}},s()]),"obstacle"]),e-=center().x;add([rect(r,r),pos(e+center().x/2,i),anchor("center"),rotate(0),move(RIGHT,120),area(),o(),"bait"])})),onKeyPress("space",(()=>{n.speed=-1*n.speed})),onTouchStart((()=>{n.speed=-1*n.speed})),n.onCollide("bait",(t=>t.destroy())),n.onCollide("obstacle",(t=>{shake(),addKaboom(n.pos)}))})),go("main");